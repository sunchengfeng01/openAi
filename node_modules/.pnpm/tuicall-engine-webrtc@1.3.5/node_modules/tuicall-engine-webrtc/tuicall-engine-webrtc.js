!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("trtc-js-sdk"),require("rtc-ai-denoiser"),require("tim-js-sdk"),require("tsignaling")):"function"==typeof define&&define.amd?define(["trtc-js-sdk","rtc-ai-denoiser","tim-js-sdk","tsignaling"],t):"object"==typeof exports?exports["tuicall-engine-webrtc"]=t(require("trtc-js-sdk"),require("rtc-ai-denoiser"),require("tim-js-sdk"),require("tsignaling")):e["tuicall-engine-webrtc"]=t(e.TRTC,e.RTCAIDenoiser,e.TIM,e.TSignaling)}(window,(function(e,t,n,i){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=29)}([function(e,t,n){"use strict";n.r(t);var i=n(4),r=n(1);let s=0;const a=new Map;function o(){const e=new Date;return`TUICallEngine ${e.toLocaleTimeString("en-US",{hour12:!1})}.${function(e){let t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(e.getMilliseconds())}:`}const l={_data:[],_length:0,_visible:!1,arguments2String(e){let t;if(1===e.length)t=o()+e[0];else{t=o();for(let n=0,{length:i}=e;n<i;n++)Object(r.isArrayOrObject)(e[n])?Object(r.isInstanceOfError)(e[n])?t+=Object(r.stringifyError)(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" "}return t},debug(){if(s<=-1){const e=this.arguments2String(arguments);l.record(e,"debug"),i.a.debug(e)}},log(){if(s<=0){const e=this.arguments2String(arguments);l.record(e,"log"),i.a.log(e)}},info(){if(s<=1){const e=this.arguments2String(arguments);l.record(e,"info"),i.a.info(e)}},warn(){if(s<=2){const e=this.arguments2String(arguments);l.record(e,"warn"),i.a.warn(e)}},error(){if(s<=3){const e=this.arguments2String(arguments);l.record(e,"error"),i.a.error(e)}},time(e){a.set(e,r.TimeUtil.now())},timeEnd(e){if(a.has(e)){const t=r.TimeUtil.now()-a.get(e);return a.delete(e),t}return i.a.warn(`未找到对应label: ${e}, 请在调用 logger.timeEnd 前，调用 logger.time`),0},setLevel(e){e<4&&i.a.log(`${o()}set level from ${s} to ${e}`),s=e},getLevel:()=>s,record(e,t){1100===l._length&&(l._data.splice(0,100),l._length=1e3),l._length++,l._data.push(`${e} [${t}] \n`)},getLog:()=>l._data};t.default=l},function(e,t,n){"use strict";n.r(t),n.d(t,"isMap",(function(){return r})),n.d(t,"isSet",(function(){return s})),n.d(t,"isFile",(function(){return a})),n.d(t,"isNumber",(function(){return o})),n.d(t,"isString",(function(){return l})),n.d(t,"isObject",(function(){return u})),n.d(t,"isPlainObject",(function(){return c})),n.d(t,"isArray",(function(){return d})),n.d(t,"isUndefined",(function(){return h})),n.d(t,"isNativeClass",(function(){return _})),n.d(t,"isArrayOrObject",(function(){return f})),n.d(t,"isFunction",(function(){return E})),n.d(t,"isInstanceOfError",(function(){return I})),n.d(t,"getType",(function(){return g})),n.d(t,"TimeUtil",(function(){return T})),n.d(t,"stringifyError",(function(){return C})),n.d(t,"map2String",(function(){return m})),n.d(t,"randomString",(function(){return A})),n.d(t,"isValidType",(function(){return D})),n.d(t,"mapKeys",(function(){return S})),n.d(t,"mapValues",(function(){return O})),n.d(t,"generateRandomRoomID",(function(){return b})),n.d(t,"formatDuration",(function(){return N})),n.d(t,"compareVersion",(function(){return w})),n.d(t,"date2ISOString",(function(){return U})),n.d(t,"getHostType",(function(){return P}));var i=n(8);const r=function(e){return"map"===g(e)},s=function(e){return"set"===g(e)},a=function(e){return"file"===g(e)},o=function(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"==typeof e&&e.constructor===Number)},l=function(e){return"string"==typeof e},u=function(e){return null!==e&&"object"==typeof e},c=function(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);if(null===t)return!0;let n=t;for(;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n},d=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===g(e)},h=function(e){return void 0===e},p=/^class\s/,_=function(e){return"function"==typeof e&&p.test(e.toString())},f=function(e){return d(e)||u(e)},E=function(e){return"function"==typeof e},I=function(e){return e instanceof Error},g=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()};let v=0;Date.now||(Date.now=function(){return(new Date).getTime()});const T={now(){0===v&&(v=Date.now()-1);const e=Date.now()-v;return e>4294967295?(v+=4294967295,Date.now()-v):e},utc:()=>Math.round(Date.now()/1e3)},C=function(e){return JSON.stringify(e,["message","code"])},m=function(e){if(!r(e))return"not a map!!!";let t="";for(const[n,i]of e.entries()){if(r(i))return`[k=${n} -> ${m(i)}`;t+=`[k=${n} v=${i}] `}return t},y="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",L=y.length,A=function(){let e="";for(let t=32;t>0;--t)e+=y[Math.floor(Math.random()*L)];return e},D=function(e,t){for(const n in e)if(e[n]===t)return!0;return!1};function S(e,t){const n={};return Object.keys(e).forEach(i=>{n[t(e[i],i)]=e[i]}),n}function O(e,t){const n={};return Object.keys(e).forEach(i=>{n[i]=t(e[i],i)}),n}function b(){return Math.round(1e8*Math.random())}function R(e){return e<10?"0"+e:e}function N(e){if(e<60)return"00:00:"+R(e);if(e<3600){const t=parseInt(e/60),n=e-60*t;return`00:${R(t)}:${R(n)}`}const t=parseInt(e/3600),n=e-3600*t,i=parseInt(n/60),r=n-60*i;return`${R(t)}:${R(i)}:${R(r)}`}function w(e,t){e=e.split("."),t=t.split(".");const n=Math.max(e.length,t.length);for(;e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(let i=0;i<n;i++){const n=parseInt(e[i]),r=parseInt(t[i]);if(n>r)return 1;if(n<r)return-1}return 0}const U=function(){const e=new Date,t=e.toISOString(),n=e.getTimezoneOffset()/60;let i="";return i=n<0?n>-10?"+0"+Math.abs(100*n):"+"+Math.abs(100*n):n>=10?"-"+100*n:"-0"+100*n,t.replace("Z",i)};function P(){let e="unknown";return i.IS_MAC&&(e="mac"),i.IS_WIN&&(e="windows"),i.IS_IOS&&(e="ios"),i.IS_ANDROID&&(e="android"),e}},function(e,t,n){"use strict";var i=n(17),r=Object.prototype.toString;function s(e){return"[object Array]"===r.call(e)}function a(e){return void 0===e}function o(e){return null!==e&&"object"==typeof e}function l(e){if("[object Object]"!==r.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function u(e){return"[object Function]"===r.call(e)}function c(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),s(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}e.exports={isArray:s,isArrayBuffer:function(e){return"[object ArrayBuffer]"===r.call(e)},isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:o,isPlainObject:l,isUndefined:a,isDate:function(e){return"[object Date]"===r.call(e)},isFile:function(e){return"[object File]"===r.call(e)},isBlob:function(e){return"[object Blob]"===r.call(e)},isFunction:u,isStream:function(e){return o(e)&&u(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:c,merge:function e(){var t={};function n(n,i){l(t[i])&&l(n)?t[i]=e(t[i],n):l(n)?t[i]=e({},n):s(n)?t[i]=n.slice():t[i]=n}for(var i=0,r=arguments.length;i<r;i++)c(arguments[i],n);return t},extend:function(e,t,n){return c(t,(function(t,r){e[r]=n&&"function"==typeof t?i(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={UNKNOWN:65535,NO_SDK_APPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USER_SIG:2003,NO_TINY_ID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,NO_NETWORK:2805,FAILURE_SWITCH_TO_AUDIO:60001,FAILURE_SWITCH_TO_VIDEO:60002,NOT_MICROPHONE_LIST:60003,NOT_CAMERA_LIST:60004,NOT_MEDIA_ACCESS:60005,NOT_SUPPORT:60006,ERROR_PACKAGE_NOT_PURCHASED:-1001,ERROR_PACKAGE_NOT_SUPPORTED:-1002,ERROR_TIM_VERSION_OUTDATED:-1003,ERROR_PERMISSION_DENIED:-1101,ERROR_GET_DEVICE_LIST_FAIL:-1102,ERROR_INIT_FAIL:-1201,ERROR_PARAM_INVALID:-1202,ERROR_REQUEST_REFUSED:-1203,ERROR_REQUEST_REPEATED:-1204,ERROR_SCENE_NOT_SUPPORTED:-1205,ERROR_SIGNALING_SEND_FAIL:-1401}},function(e,t,n){"use strict";(function(e){let n,i;n="undefined"!=typeof console?console:void 0!==e&&e.console?e.console:"undefined"!=typeof window&&window.console?window.console:{};const r=function(){},s=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];let{length:a}=s;for(;a--;)i=s[a],console[i]||(n[i]=r);n.methods=s,t.a=n}).call(this,n(33))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={NO_SDK_APPID:"无 SDKAppID",NO_ACCOUNT_TYPE:"无 accountType",NO_IDENTIFIER:"无 userID",NO_USER_SIG:"无 userSig",NO_NETWORK:"未连接到网络",FAILURE_SWITCH_TO_AUDIO:"switch to audio call error",FAILURE_SWITCH_TO_VIDEO:"switch to video call error",NOT_MICROPHONE_LIST:"No microphone or microphone permission denied",NOT_CAMERA_LIST:"No camera or camera permission denied",ERROR_NULL:"success",ERROR_PACKAGE_NOT_PURCHASED:"You do not currently have TUICallKit package, please open the free experience in the console or purchase the official package",ERROR_PACKAGE_NOT_SUPPORTED:'The package you purchased does not support this ability. You can refer to "Service Activation" to purchase: https://buy.cloud.tencent.com/avc',ERROR_TIM_VERSION_OUTDATED:"TIM SDK version is too old, Please upgrade version",ERROR_PERMISSION_DENIED:"camera permission refused / microphone permission refused, You can perform the trtc capability test at https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html to check whether the current environment supports audio and video calls.",ERROR_GET_DEVICE_LIST_FAIL:"Failed to get device list",ERROR_INIT_FAIL:"init is not complete, this API needs to be used after init",ERROR_REQUEST_REFUSED:"The API is support use in the state of",ERROR_REQUEST_REPEATED:"The current method is being executed, please do not call it repeatedly",ERROR_REQUEST_REPEATED_SWITCH:"Consistent with the current call type, please do not switch repeatedly",ERROR_SCENE_NOT_SUPPORTED:"In the current call scene, this function is not supported",ERROR_SIGNALING_SEND_FAIL:"signaling failed to send"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEVICEID_TYPE=t.DEVICE_TYPE=t.CALL_EXPERMENTEL_API_TYPE=t.MODE_TYPE=t.VALID_VIDEO_PROFILE_LIST=t.BUSINESS_ID=t.ACTION_TYPE=t.CALL_ROLE=t.CALL_STATUS=t.CMD_TYPE=t.CMD_TYPE_LIST=t.CALL_TYPE=void 0,function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.AUDIO_CALL=1]="AUDIO_CALL",e[e.VIDEO_CALL=2]="VIDEO_CALL"}(t.CALL_TYPE||(t.CALL_TYPE={})),t.CMD_TYPE_LIST=["","audioCall","videoCall"],function(e){e.AUDIO_CALL="audioCall",e.VIDEO_CALL="videoCall",e.HANG_UP="hangup",e.SWITCH_TO_AUDIO="switchToAudio",e.SWITCH_TO_AUDIO_CALL="switch_to_audio_call",e.SWITCH_TO_VIDEO="switchToVideo"}(t.CMD_TYPE||(t.CMD_TYPE={})),function(e){e.IDLE="idle",e.CALLING="calling",e.CONNECTED="connected"}(t.CALL_STATUS||(t.CALL_STATUS={})),function(e){e.UNKNOWN="",e.INVITER="inviter",e.INVITEE="invitee"}(t.CALL_ROLE||(t.CALL_ROLE={})),function(e){e[e.INVITE=1]="INVITE",e[e.CANCEL_INVITE=2]="CANCEL_INVITE",e[e.ACCEPT_INVITE=3]="ACCEPT_INVITE",e[e.REJECT_INVITE=4]="REJECT_INVITE",e[e.INVITE_TIMEOUT=5]="INVITE_TIMEOUT"}(t.ACTION_TYPE||(t.ACTION_TYPE={})),function(e){e[e.SIGNAL=1]="SIGNAL"}(t.BUSINESS_ID||(t.BUSINESS_ID={})),t.VALID_VIDEO_PROFILE_LIST=["240p","360p","480p","720p","1080p"],function(e){e.AUDIO="audio",e.VIDEO="video"}(t.MODE_TYPE||(t.MODE_TYPE={})),function(e){e[e.BASE=Math.pow(2,16)]="BASE",e[e.PRO=Math.pow(2,17)]="PRO",e[e.ULTIMATE=Math.pow(2,18)]="ULTIMATE"}(t.CALL_EXPERMENTEL_API_TYPE||(t.CALL_EXPERMENTEL_API_TYPE={})),function(e){e.AUDIO="audio",e.VIDEO="video",e.CAMERA="camera",e.MICROPHONES="microphones"}(t.DEVICE_TYPE||(t.DEVICE_TYPE={})),function(e){e.audio="microphoneId",e.video="cameraId"}(t.DEVICEID_TYPE||(t.DEVICEID_TYPE={}))},function(e,t,n){"use strict";n.r(t);var i=n(1),r=n(0),s=n(3),a=n.n(s),o=n(5),l=n.n(o);class u{constructor(e){this.sdkappid="",this.version="",this.userid="",this.platform="",this.useragent="",this.method=e,this.codeint=1,this.calltype=1,this.talktime=0,this.message="",this.text="",this.startts=Date.now(),this.endts=0,this.timespan=0,this.time="",this.networktype="",this.host=Object(i.getHostType)()}static bindController(e){u.prototype._eventStatController=e}setCommonInfo(e){const{SDKAppID:t,version:n,userID:r,platform:s,scene:a}=e;this.sdkappid=t,this.version=""+n,this.userid=r,this.platform=s,this.scene=a,this.time=Object(i.date2ISOString)(),this.startts&&this.endts&&!this.timespan&&(this.timespan=Math.abs(this.endts-this.startts))}setEnd(e=!1){this.endts=Date.now(),e?this._eventStatController.pushIn(this):setTimeout(()=>{this._eventStatController.pushIn(this)},0)}setError(e,t,n){return this.setNetworkType(n),t?(e.code&&this.setCode(e.code),e.message&&this.setMessage(e.message)):(this.setCode(a.a.NO_NETWORK),this.setMessage(l.a.NO_NETWORK)),this}setCode(e){return"ECONNABORTED"===e&&(this.codeint=103),Object(i.isNumber)(e)?this.codeint=e:r.default.warn("SSOLogData.setCode value not a number, please check!",e,typeof e),this}setMessage(e){return Object(i.isString)(e)?(this.message=e,this):this}setText(e){return Object(i.isNumber)(e)?this.text=e.toString():Object(i.isString)(e)&&(this.text=e),this}setTalkTime(e){return this.talktime=e,this}setMessageType(e){return this.msgType=e,this}setCallType(e){return this.calltype=e,this}setNetworkType(e){return Object(i.isUndefined)(e)?r.default.warn("SSOLogData.setNetworkType value is undefined, please check!"):this.networktype=e,this}}t.default=u},function(e,t,n){"use strict";n.r(t),n.d(t,"IN_Browser",(function(){return i})),n.d(t,"IN_WXMiniProgram",(function(){return r})),n.d(t,"USER_AGENT",(function(){return s})),n.d(t,"IS_IPAD",(function(){return l})),n.d(t,"IS_IPHONE",(function(){return u})),n.d(t,"IS_IPOD",(function(){return c})),n.d(t,"IS_IOS",(function(){return d})),n.d(t,"IOS_VERSION",(function(){return h})),n.d(t,"IS_ANDROID",(function(){return p})),n.d(t,"ANDROID_VERSION",(function(){return _})),n.d(t,"IS_OLD_ANDROID",(function(){return f})),n.d(t,"IS_NATIVE_ANDROID",(function(){return E})),n.d(t,"IS_FIREFOX",(function(){return I})),n.d(t,"FIREFOX_VERSION",(function(){return g})),n.d(t,"IS_EDGE",(function(){return v})),n.d(t,"IS_EDG",(function(){return T})),n.d(t,"EDG_VERSION",(function(){return C})),n.d(t,"IS_CHROME",(function(){return m})),n.d(t,"CHROME_MAJOR_VERSION",(function(){return y})),n.d(t,"CHROME_VERSION",(function(){return L})),n.d(t,"IS_IE8",(function(){return A})),n.d(t,"IE_VERSION",(function(){return D})),n.d(t,"IS_SAFARI",(function(){return S})),n.d(t,"IS_ANY_SAFARI",(function(){return O})),n.d(t,"SAFARI_VERSION",(function(){return b})),n.d(t,"IS_TBS",(function(){return R})),n.d(t,"TBS_VERSION",(function(){return N})),n.d(t,"IS_MQQB",(function(){return w})),n.d(t,"IS_QQB",(function(){return U})),n.d(t,"IS_WECHAT",(function(){return P})),n.d(t,"IS_WIN",(function(){return M})),n.d(t,"IS_MAC",(function(){return V})),n.d(t,"IS_LINUX",(function(){return k})),n.d(t,"IS_WX",(function(){return j})),n.d(t,"IS_UCBROWSER",(function(){return x})),n.d(t,"IS_MIUIBROWSER",(function(){return G})),n.d(t,"IS_HUAWEIBROWSER",(function(){return Y})),n.d(t,"BROWSER_VERSION",(function(){return B})),n.d(t,"IS_LOCAL",(function(){return H}));const i="undefined"!=typeof window,r="undefined"!=typeof wx,s=window.navigator&&window.navigator.userAgent||"",a=/AppleWebKit\/([\d.]+)/i.exec(s),o=a?parseFloat(a.pop()):null,l=/iPad/i.test(s),u=/iPhone/i.test(s)&&!l,c=/iPod/i.test(s),d=u||l||c,h=function(){const e=s.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null}(),p=/Android/i.test(s),_=function(){const e=s.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(`${e[1]}.${e[2]}`):t||null}(),f=p&&/webkit/i.test(s)&&_<2.3,E=p&&_<5&&o<537,I=/Firefox/i.test(s),g=function(){const e=s.match(/Firefox\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),v=/Edge\//i.test(s),T=/Edg\//i.test(s),C=function(){const e=s.match(/Edg\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),m=!v&&/Chrome/i.test(s),y=function(){const e=s.match(/Chrome\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),L=function(){const e=s.match(/Chrome\/([\d.]+)/);return e&&e[1]?e[1]:null}(),A=/MSIE\s8\.0/.test(s),D=function(){const e=/MSIE\s(\d+)\.\d/.exec(s);let t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(s)&&/rv:11.0/.test(s)&&(t=11),t}(),S=/Safari/i.test(s)&&!m&&!p&&!v,O=S||d,b=function(){const e=s.match(/Version\/([\d.]+)/);return e&&e[1]?e[1]:null}(),R=/TBS\/\d+/i.test(s),N=function(){const e=s.match(/TBS\/(\d+)/i);if(e&&e[1])return e[1]}(),w=!R&&/MQQBrowser\/\d+/i.test(s),U=!R&&/ QQBrowser\/\d+/i.test(s),P=/(micromessenger|webbrowser)/i.test(s),M=/Windows/i.test(s),V=/MAC OS X/i.test(s),k=/Linux/i.test(s),j=/MicroMessenger/i.test(s),x=/UCBrowser/i.test(s),G=/MiuiBrowser/i.test(s),Y=/HuaweiBrowser/i.test(s),B=m?"Chrome/"+L:S?"Safari/"+b:"NotSupportedBrowser",H="file:"===location.protocol||"localhost"===location.hostname||/^\d+\.\d+\.\d+\.\d+$/.test(location.hostname)},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),a=function(e){function t(t){var n=t.message,i=t.code,r=void 0===i?s.default.UNKNOWN:i,a=e.call(this,n+" <"+function(e){for(var t in s.default)if(s.default[t]===e)return t;return"UNKNOWN"}(r)+": "+r+">")||this;return a.code=r,a.name="TUICallEngineError",a.message_=n,a}return r(t,e),t.prototype.getCode=function(){return this.code},t}(Error);t.default=a},function(e,t,n){"use strict";n.r(t),n.d(t,"mainUrl",(function(){return i})),n.d(t,"backupUrl",(function(){return r})),n.d(t,"Mode",(function(){return s})),n.d(t,"Role",(function(){return a})),n.d(t,"VIDEO_STAT_BIT",(function(){return o})),n.d(t,"AUDIO_STAT_BIT",(function(){return l})),n.d(t,"AUDIO_MUTE_BIT",(function(){return u})),n.d(t,"VIDEO_MUTE_BIT",(function(){return c})),n.d(t,"VIDEO_MUTED_MASK",(function(){return d})),n.d(t,"AUX_VIDEO_MUTED_MASK",(function(){return h})),n.d(t,"AUDIO_MUTED_MASK",(function(){return p})),n.d(t,"MAIN_STREAM_MSID",(function(){return _})),n.d(t,"AUX_STREAM_MSID",(function(){return f})),n.d(t,"StreamType",(function(){return E})),n.d(t,"TRTC_QUALITY_UNKNOWN",(function(){return I})),n.d(t,"TRTC_QUALITY_EXCELLENT",(function(){return g})),n.d(t,"TRTC_QUALITY_GOOD",(function(){return v})),n.d(t,"TRTC_QUALITY_POOR",(function(){return T})),n.d(t,"TRTC_QUALITY_BAD",(function(){return C})),n.d(t,"TRTC_QUALITY_VBAD",(function(){return m})),n.d(t,"TRTC_QUALITY_DISCONNECTED",(function(){return y})),n.d(t,"DTLS_STATE_UNKNOWN",(function(){return L})),n.d(t,"SuccessRate",(function(){return A})),n.d(t,"MTA_API_PENDING",(function(){return D})),n.d(t,"MTA_API_SUCCESS",(function(){return S})),n.d(t,"ConnectionState",(function(){return O})),n.d(t,"UPLINK_RECONNECTION_COUNT",(function(){return b})),n.d(t,"DOWNLINK_RECONNECTION_COUNT",(function(){return R})),n.d(t,"SIGNAL_RECONNECTION_COUNT",(function(){return N})),n.d(t,"KIBANA_EVENT",(function(){return w})),n.d(t,"SIGNAL_PING_TIMEOUT",(function(){return U})),n.d(t,"SIGNAL_PING_PONG_INTERVAL",(function(){return P})),n.d(t,"INNER_EVENT",(function(){return M})),n.d(t,"AI_NOISE_REDUCE_ASSETS_PATH",(function(){return V})),n.d(t,"NAME",(function(){return k}));const i="wss://qcloud.rtc.qq.com:8687",r="wss://bk.rtc.qq.com:8687",s={RTC:1,LIVE:2},a={HOST:20,AUDIENCE:21},o=1,l=8,u=64,c=16,d=1,h=2,p=4,_="5Y2wZK8nANNAoVw6dSAHVjNxrD1ObBM2kBPV",f="224d130c-7b5c-415b-aaa2-79c2eb5a6df2",E={NONE:0,AUDIO:1,MAIN:2,AUX:7},I=0,g=1,v=2,T=3,C=4,m=5,y=6,L="unknown",A={JOIN:"join",PUBLISH:"publish",UNPUBLISH:"unpublish",LOCAL_STREAM_INITIALIZE:"local_stream_initialize",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscibe",UPLINK_CONNECTION:"uplink_connection",UPLINK_RECONNECTION:"uplink_reconnection",DOWNLINK_CONNECTION:"downlink_connection",DOWNLINK_RECONNECTION:"downlink_reconnection",SIGNAL_CONNECTION:"signal_connection",SIGNAL_RECONNECTION:"signal_reconnection",UPDATE_STREAM:"update_stream"},D="pending",S="success",O={CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected"},b=30,R=30,N=30,w={SDK_CONSTRUCT:"sdkConstruct",SDK_LOGIN:"sdkLogin",DELTA_JOIN:"delta-join",REJOIN:"rejoin",LEAVE:"leave",DELTA_LEAVE:"delta-leave",PUBLISH:"publish",DELTA_PUBLISH:"delta-publish",UNPUBLISH:"unpublish",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",UPLINK_CONNECTION:"uplink-connection",UPLINK_RECONNECTION:"uplink-reconnection",DOWNLINK_CONNECTION:"downlink-connection",DOWNLINK_RECONNECTION:"downlink-reconnection",ON_TRACK:"ontrack",SET_LOCAL_DESCRIPTION:"setLocalDescription",SET_REMOTE_DESCRIPTION:"setRemoteDescription",ICE_CONNECTION_STATE:"iceConnectionState",LOCAL_STREAM_INITIALIZE:"stream-initialize",SIGNAL_CONNECTION:"websocketConnectionState",SIGNAL_RECONNECTION:"websocketReconnectionState",UPDATE_STREAM:"update-stream",RECOVER_SUBSCRIPTION:"recover-subscription"},U=6e3,P=1e4,M={SET_REMOTE_OFFER_FINISHED:"set-remote-offer-finished"},V="https://web.sdk.qcloud.com/trtc/webrtc/download/aiNoiseReduce/",k={DEFAULT:"default",VIDEO:"video",AUDIO:"audio",ON_ERROR:"onError",MAIN:"main",RTC:"rtc",LIVE:"live",SMALL:"small",BIG:"big",AUXILIARY:"auxiliary",NUMBER:"number",STRING:"string",INVITER:"inviter",INVITEE:"invitee",VIDEO_INPUT:"videoinput",AUDIO_INPUT:"audioinput",LOCAL:"local",REMOTE:"remote",TRTC:"TRTC",WEB:"web",NORMAL:"normal",REJECT:"reject",IGNORE:"ignore",TIMEOUT:"timeout",CANCEL:"cancel",BUSYLINE:"busyline",UNKNOWN:"unknown",SINGLE_CALL:"SingleCall",GROUP_CALL:"groupCall",CALLER:"caller",CALLEE:"callee"}},function(e,t,n){"use strict";n.r(t);t.default={SDK_CONSTRUCT:"sdkConstruct",SDK_READY:"sdkReady",SDK_NOT_READY:"sdkNotReady",LOGIN:"login",LOGOUT:"logout",CALL:"call",GROUP_CALL:"groupCall",ACCEPT:"accept",REJECT:"reject",HANGUP:"hangup",START_REMOTE_VIEW:"startRemoteView",STOP_REMOTE_VIEW:"stopRemoteView",START_LOCAL_VIEW:"startLocalView",STOP_LOCAL_VIEW:"stopLocalView",OPEN_CAMERA:"openCamera",CLOSE_CAMERA:"closeCamera",SET_MIC_MUTE:"setMicMute",SET_VIDEO_QUALITY:"setVideoQuality",SWITCH_TO_AUDIO_CALL:"switchToAudioCall",SWITCH_TO_VIDEO_CALL:"switchToVideoCall",CHANGE_CALL_STATUS:"changeCallStatus",TALK_TIME:"talktime",ERROR:"error",INVITED:"invited",GROUP_CALL_INVITEE_LIST_UPDATE:"group_call_invitee_list_update",USER_ENTER:"user_enter",USER_LEAVE:"user_leave",NO_RESP:"no_resp",LINE_BUSY:"line_busy",CALLING_CANCEL:"calling_cancel",KICKED_OUT:"kicked_out",CALLING_TIMEOUT:"calling_timeout",CALLING_END:"calling_end",USER_VIDEO_AVAILABLE:"user_video_available",USER_AUDIO_AVAILABLE:"user_audio_available",USER_VOICE_VOLUME:"user_voice_volume",CALL_TYPE_CHANGED:"call_type_changed",DEVICED_UPDATED:"deviced_updated",QUALITY_REPORT:"quality_report"}},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return _}));var i=n(0),r=n(1);class s{constructor(){this._table="timweb-trtccalling",this._report=[]}pushIn(e){i.default.debug("SSOLogBody.pushIn",this._report.length,e),this._report.push(e)}backfill(e){Object(r.isArray)(e)&&0!==e.length&&(i.default.debug("SSOLogBody.backfill",this._report.length,e.length),this._report.unshift(...e))}getLogsNumInMemory(){return this._report.length}isEmpty(){return 0===this._report.length}_reset(){this._report.length=0,this._report=[]}getTable(){return this._table}getLogsInMemory(){const e=this._report.slice();return this._reset(),e}}var a=n(7),o=n(15),l=n(27),u=n.n(l);const c={CURRENT:{COMMON:"https://webim.tim.qq.com"},PRODUCTION:{COMMON:"https://webim.tim.qq.com"},OVERSEA_PRODUCTION:{COMMON:"https://api.im.qcloud.com"},SANDBOX:{COMMON:"https://events.tim.qq.com"},TEST:{COMMON:"https://test.tim.qq.com"}},d={IM_OPEN_STAT:"imopenstat"},h={TIM_WEB_TRTCCALLING_REPORT:"tweb_trtccalling_report"},p={imopenstat:"v4"};class _{constructor(){this.TAG="trtccalling-ssolog-event",this._reportBody=new s,this._version=o.version||"",this.MIN_THRESHOLD=20,this.MAX_THRESHOLD=100,this.WAITING_TIME=6e4,this.INTERVAL=2e4,this._timerID=0,this._resetLastReportTime(),this._startReportTimer(),this._retryCount=0,this.MAX_RETRY_COUNT=3}reportAtOnce(){i.default.debug("EventStatController.reportAtOnce"),this._report()}pushIn(e){e instanceof a.default&&(e.setCommonInfo({SDKAppID:Number(sessionStorage.getItem("sdkAppId")),version:this._version,userID:sessionStorage.getItem("userId")}),this._reportBody.pushIn(e),this._report())}_resetLastReportTime(){this._lastReportTime=Date.now()}_startReportTimer(){this._timerID=setInterval(()=>{Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()},this.INTERVAL)}_stopReportTimer(){this._timerID>0&&(clearInterval(this._timerID),this._timerID=0)}_report(){if(this._reportBody.isEmpty())return;const e=Math.ceil(+new Date/1e3),t=sessionStorage.getItem("sdkAppId"),n=this._reportBody.getLogsInMemory(),s={table:this._reportBody.getTable(),report:n},a=`${c.CURRENT.COMMON}/${p.imopenstat}/${d.IM_OPEN_STAT}/${h.TIM_WEB_TRTCCALLING_REPORT}/?sdkappid=${t}&reqtime=${e}`;u.a.post(a,JSON.stringify(s)).then(()=>{this._resetLastReportTime(),this._retryCount>0&&(i.default.debug("EventStatController.report retry success"),this._retryCount=0)}).catch(e=>{i.default.warn("EventStatController.report, error:"+Object(r.stringifyError)(e)),this._reportBody.backfill(n);this._reportBody.getLogsNumInMemory()>this.MAX_THRESHOLD||this._retryCount===this.MAX_RETRY_COUNT||0===this._timerID?this._retryCount=0:this._retryCount+=1})}reset(){i.default.log("EventStatController.reset"),this._stopReportTimer(),this._report()}}},function(e,t,n){"use strict";(function(t){var i=n(2),r=n(40),s=n(19),a={"Content-Type":"application/x-www-form-urlencoded"};function o(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var l,u={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(l=n(20)),l),transformRequest:[function(e,t){return r(t,"Accept"),r(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(o(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)||t&&"application/json"===t["Content-Type"]?(o(t,"application/json"),function(e,t,n){if(i.isString(e))try{return(t||JSON.parse)(e),i.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,a=!n&&"json"===this.responseType;if(a||r&&i.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(a){if("SyntaxError"===e.name)throw s(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300}};u.headers={common:{Accept:"application/json, text/plain, */*"}},i.forEach(["delete","get","head"],(function(e){u.headers[e]={}})),i.forEach(["post","put","patch"],(function(e){u.headers[e]=i.merge(a)})),e.exports=u}).call(this,n(39))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TUICallEvent=void 0,t.TUICallEvent={ERROR:"onError",SDK_READY:"sdkReady",INVITED:"onInvited",USER_ACCEPT:"onUserAccept",USER_ENTER:"onUserEnter",USER_LEAVE:"onUserLeave",REJECT:"onReject",NO_RESP:"onNoResp",LINE_BUSY:"onLineBusy",CALLING_CANCEL:"onCallingCancel",KICKED_OUT:"onKickedOut",CALLING_TIMEOUT:"onCallingTimeout",CALL_END:"onCallEnd",CALLING_END:"onCallEnd",USER_VIDEO_AVAILABLE:"onUserVideoAvailable",USER_AUDIO_AVAILABLE:"onUserAudioAvailable",USER_VOICE_VOLUME:"onUserVoiceVolume",GROUP_CALL_INVITEE_LIST_UPDATE:"onGroupCallInviteeListUpdate",CALL_TYPE_CHANGED:"onCallTypeChanged",DEVICED_UPDATED:"onDeviceUpdated",MESSAGE_SENT_BY_ME:"onMessageSentByMe"}},function(e){e.exports=JSON.parse('{"name":"tuicall-engine-webrtc","version":"1.3.5","description":"腾讯云 tuicall-engine-webrtc","main":"index","private":true,"dependencies":{"axios":"^0.21.0","dayjs":"^1.11.7","EventEmitter":"^1.0.0","rtc-ai-denoiser":"^1.1.3","tim-js-sdk":"^2.26.2","trtc-js-sdk":"^4.15.3","tsignaling":"^1.0.5","tuicall-engine-webrtc":"^1.3.4"},"devDependencies":{"@babel/preset-typescript":"^7.12.7","@tencent/eslint-config-tencent":"^0.16.1","@typescript-eslint/eslint-plugin":"^4.33.0","@typescript-eslint/parser":"^4.33.0","docdash-blue":"^1.1.9","eslint":"^7.27.0","eslint-config-google":"^0.14.0","eslint-plugin-prettier":"^4.0.0","fs-extra":"^9.0.1","jsdoc":"^3.6.11","prettier":"^2.5.0","pretty":"^2.0.0","replace":"^1.2.2","rimraf":"^4.1.2","ts-loader":"^8.4.0","typescript":"^3.9.7","watch":"^1.0.2","webpack":"^4.44.1","webpack-cli":"^3.3.12"},"scripts":{"watch":"watch \'npm run build_withcopy2\' src","dev":"npm run watch","build":"webpack --config webpack.config.js","build_withcopy":"npm run build && cp dist/npm/tuicall-engine-webrtc.js ../../github/TUICalling/Web/node_modules/tuicall-engine-webrtc/tuicall-engine-webrtc.js","build_withcopy2":"npm run build && cp dist/npm/tuicall-engine-webrtc.js ../sdk/trtc-calling-webrtc-demo/node_modules/tuicall-engine-webrtc/tuicall-engine-webrtc.js","build_withcopy3":"npm run build && cp dist/npm/tuicall-engine-webrtc.js ../calling-file/tuicall-engine-webrtc.js","build:package":"node build/package-bundle.js","lint":"./node_modules/.bin/eslint ./src; exit 0","fix":"./node_modules/.bin/eslint --fix ./src; exit 0","prerelease":"npm run lint && npm run build && npm run doc && npm run build:package","doc":"npm run doc:clean && tsc  --target ESNEXT && npm run doc:build","doc:build":"npm run changelog && npm run main && ./node_modules/.bin/jsdoc -c build/jsdoc/jsdoc.json && node ./build/jsdoc/fix-doc.js","doc:clean":"node ./build/jsdoc/clean-doc.js","changelog":"cp CHANGELOG.md build/jsdoc/tutorials/20-CHANGELOG.md","main":"cp README.md build/jsdoc/main.md"},"repository":{"type":"git","url":"git@git.code.oa.com:TRDCWeb/trtc-calling-webrtc.git"},"author":"Tencent Cloud Terminal R&D Center","license":"ISC"}')},function(t,n){t.exports=e},function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}}},function(e,t,n){"use strict";var i=n(2);function r(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var s;if(n)s=n(t);else if(i.isURLSearchParams(t))s=t.toString();else{var a=[];i.forEach(t,(function(e,t){null!=e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,(function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),a.push(r(t)+"="+r(e))})))})),s=a.join("&")}if(s){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},function(e,t,n){"use strict";e.exports=function(e,t,n,i,r){return e.config=t,n&&(e.code=n),e.request=i,e.response=r,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,n){"use strict";var i=n(2),r=n(41),s=n(42),a=n(18),o=n(43),l=n(46),u=n(47),c=n(21);e.exports=function(e){return new Promise((function(t,n){var d=e.data,h=e.headers,p=e.responseType;i.isFormData(d)&&delete h["Content-Type"];var _=new XMLHttpRequest;if(e.auth){var f=e.auth.username||"",E=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";h.Authorization="Basic "+btoa(f+":"+E)}var I=o(e.baseURL,e.url);function g(){if(_){var i="getAllResponseHeaders"in _?l(_.getAllResponseHeaders()):null,s={data:p&&"text"!==p&&"json"!==p?_.response:_.responseText,status:_.status,statusText:_.statusText,headers:i,config:e,request:_};r(t,n,s),_=null}}if(_.open(e.method.toUpperCase(),a(I,e.params,e.paramsSerializer),!0),_.timeout=e.timeout,"onloadend"in _?_.onloadend=g:_.onreadystatechange=function(){_&&4===_.readyState&&(0!==_.status||_.responseURL&&0===_.responseURL.indexOf("file:"))&&setTimeout(g)},_.onabort=function(){_&&(n(c("Request aborted",e,"ECONNABORTED",_)),_=null)},_.onerror=function(){n(c("Network Error",e,null,_)),_=null},_.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(c(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",_)),_=null},i.isStandardBrowserEnv()){var v=(e.withCredentials||u(I))&&e.xsrfCookieName?s.read(e.xsrfCookieName):void 0;v&&(h[e.xsrfHeaderName]=v)}"setRequestHeader"in _&&i.forEach(h,(function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete h[t]:_.setRequestHeader(t,e)})),i.isUndefined(e.withCredentials)||(_.withCredentials=!!e.withCredentials),p&&"json"!==p&&(_.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&_.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&_.upload&&_.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){_&&(_.abort(),n(e),_=null)})),d||(d=null),_.send(d)}))}},function(e,t,n){"use strict";var i=n(19);e.exports=function(e,t,n,r,s){var a=new Error(e);return i(a,t,n,r,s)}},function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";var i=n(2);e.exports=function(e,t){t=t||{};var n={},r=["url","method","data"],s=["headers","auth","proxy","params"],a=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],o=["validateStatus"];function l(e,t){return i.isPlainObject(e)&&i.isPlainObject(t)?i.merge(e,t):i.isPlainObject(t)?i.merge({},t):i.isArray(t)?t.slice():t}function u(r){i.isUndefined(t[r])?i.isUndefined(e[r])||(n[r]=l(void 0,e[r])):n[r]=l(e[r],t[r])}i.forEach(r,(function(e){i.isUndefined(t[e])||(n[e]=l(void 0,t[e]))})),i.forEach(s,u),i.forEach(a,(function(r){i.isUndefined(t[r])?i.isUndefined(e[r])||(n[r]=l(void 0,e[r])):n[r]=l(void 0,t[r])})),i.forEach(o,(function(i){i in t?n[i]=l(e[i],t[i]):i in e&&(n[i]=l(void 0,e[i]))}));var c=r.concat(s).concat(a).concat(o),d=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===c.indexOf(e)}));return i.forEach(d,u),n}},function(e,t,n){"use strict";function i(e){this.message=e}i.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},i.prototype.__CANCEL__=!0,e.exports=i},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.validateBusiness=t.businessValidate=void 0;var s=n(9),a=n(3),o=n(5),l=n(6);function u(e,t,n){return i(this,void 0,void 0,(function(){return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.tim.callExperimentalAPI("isCommercialAbilityEnabled",e)];case 1:if(i.sent().data.enabled)return[2,t.apply(this,n)];try{e===l.CALL_EXPERMENTEL_API_TYPE.BASE&&(this._callDataReport.setCodeAndMessage(a.default.ERROR_PACKAGE_NOT_SUPPORTED,o.default.ERROR_PACKAGE_NOT_SUPPORTED),this._callDataReport.uploadToKibana())}catch(e){console.warn("base ability check failed, userId:"+this.getUserID()+", error: "+e)}throw new s.default({message:o.default.ERROR_PACKAGE_NOT_SUPPORTED,code:a.default.ERROR_PACKAGE_NOT_SUPPORTED});case 2:throw 2905===i.sent().code?new s.default({message:o.default.ERROR_TIM_VERSION_OUTDATED+" >= 2.21.2",code:a.default.ERROR_TIM_VERSION_OUTDATED}):new s.default({message:o.default.ERROR_PACKAGE_NOT_SUPPORTED,code:a.default.ERROR_PACKAGE_NOT_SUPPORTED});case 3:return[2]}}))}))}t.businessValidate=function(e){return function(t,n,s){var a=s.value;return s.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,u.call(this,e,a,t)];case 1:return[2,n.sent()];case 2:throw n.sent();case 3:return[2]}}))}))},s}},t.validateBusiness=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e.callExperimentalAPI("isCommercialAbilityEnabled",t)];case 1:if((n=i.sent()).data.enabled)return[2,Promise.resolve(n.data.enabled)];throw new s.default({message:o.default.ERROR_PACKAGE_NOT_SUPPORTED,code:a.default.ERROR_PACKAGE_NOT_SUPPORTED});case 2:throw 2905===i.sent().code?new s.default({message:o.default.ERROR_TIM_VERSION_OUTDATED+" >= 2.21.2",code:a.default.ERROR_TIM_VERSION_OUTDATED}):new s.default({message:o.default.ERROR_PACKAGE_NOT_SUPPORTED,code:a.default.ERROR_PACKAGE_NOT_SUPPORTED});case 3:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.API_STATUS=t.VALIDATE_TYPR=void 0,function(e){e.NUMBER="number",e.STRING="string",e.FUNCTION="function",e.OBJECT="object",e.ARRAY="array"}(t.VALIDATE_TYPR||(t.VALIDATE_TYPR={})),function(e){e.ADD="add",e.DEL="del"}(t.API_STATUS||(t.API_STATUS={}))},function(e,t,n){e.exports=n(34)},function(e,t,n){e.exports=function(){"use strict";var e=6e4,t=36e5,n="millisecond",i="second",r="minute",s="hour",a="day",o="week",l="month",u="quarter",c="year",d="date",h="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,_=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},E=function(e,t,n){var i=String(e);return!i||i.length>=t?e:""+Array(t+1-i.length).join(n)+e},I={s:E,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),i=Math.floor(n/60),r=n%60;return(t<=0?"+":"-")+E(i,2,"0")+":"+E(r,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var i=12*(n.year()-t.year())+(n.month()-t.month()),r=t.clone().add(i,l),s=n-r<0,a=t.clone().add(i+(s?-1:1),l);return+(-(i+(n-r)/(s?r-a:a-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:c,w:o,d:a,D:d,h:s,m:r,s:i,ms:n,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},g="en",v={};v[g]=f;var T=function(e){return e instanceof L},C=function e(t,n,i){var r;if(!t)return g;if("string"==typeof t){var s=t.toLowerCase();v[s]&&(r=s),n&&(v[s]=n,r=s);var a=t.split("-");if(!r&&a.length>1)return e(a[0])}else{var o=t.name;v[o]=t,r=o}return!i&&r&&(g=r),r||!i&&g},m=function(e,t){if(T(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new L(n)},y=I;y.l=C,y.i=T,y.w=function(e,t){return m(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var L=function(){function f(e){this.$L=C(e.locale,null,!0),this.parse(e)}var E=f.prototype;return E.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(y.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var i=t.match(p);if(i){var r=i[2]-1||0,s=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,s)):new Date(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,s)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},E.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},E.$utils=function(){return y},E.isValid=function(){return!(this.$d.toString()===h)},E.isSame=function(e,t){var n=m(e);return this.startOf(t)<=n&&n<=this.endOf(t)},E.isAfter=function(e,t){return m(e)<this.startOf(t)},E.isBefore=function(e,t){return this.endOf(t)<m(e)},E.$g=function(e,t,n){return y.u(e)?this[t]:this.set(n,e)},E.unix=function(){return Math.floor(this.valueOf()/1e3)},E.valueOf=function(){return this.$d.getTime()},E.startOf=function(e,t){var n=this,u=!!y.u(t)||t,h=y.p(e),p=function(e,t){var i=y.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return u?i:i.endOf(a)},_=function(e,t){return y.w(n.toDate()[e].apply(n.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},f=this.$W,E=this.$M,I=this.$D,g="set"+(this.$u?"UTC":"");switch(h){case c:return u?p(1,0):p(31,11);case l:return u?p(1,E):p(0,E+1);case o:var v=this.$locale().weekStart||0,T=(f<v?f+7:f)-v;return p(u?I-T:I+(6-T),E);case a:case d:return _(g+"Hours",0);case s:return _(g+"Minutes",1);case r:return _(g+"Seconds",2);case i:return _(g+"Milliseconds",3);default:return this.clone()}},E.endOf=function(e){return this.startOf(e,!1)},E.$set=function(e,t){var o,u=y.p(e),h="set"+(this.$u?"UTC":""),p=(o={},o[a]=h+"Date",o[d]=h+"Date",o[l]=h+"Month",o[c]=h+"FullYear",o[s]=h+"Hours",o[r]=h+"Minutes",o[i]=h+"Seconds",o[n]=h+"Milliseconds",o)[u],_=u===a?this.$D+(t-this.$W):t;if(u===l||u===c){var f=this.clone().set(d,1);f.$d[p](_),f.init(),this.$d=f.set(d,Math.min(this.$D,f.daysInMonth())).$d}else p&&this.$d[p](_);return this.init(),this},E.set=function(e,t){return this.clone().$set(e,t)},E.get=function(e){return this[y.p(e)]()},E.add=function(n,u){var d,h=this;n=Number(n);var p=y.p(u),_=function(e){var t=m(h);return y.w(t.date(t.date()+Math.round(e*n)),h)};if(p===l)return this.set(l,this.$M+n);if(p===c)return this.set(c,this.$y+n);if(p===a)return _(1);if(p===o)return _(7);var f=(d={},d[r]=e,d[s]=t,d[i]=1e3,d)[p]||1,E=this.$d.getTime()+n*f;return y.w(E,this)},E.subtract=function(e,t){return this.add(-1*e,t)},E.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var i=e||"YYYY-MM-DDTHH:mm:ssZ",r=y.z(this),s=this.$H,a=this.$m,o=this.$M,l=n.weekdays,u=n.months,c=function(e,n,r,s){return e&&(e[n]||e(t,i))||r[n].slice(0,s)},d=function(e){return y.s(s%12||12,e,"0")},p=n.meridiem||function(e,t,n){var i=e<12?"AM":"PM";return n?i.toLowerCase():i},f={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:y.s(o+1,2,"0"),MMM:c(n.monthsShort,o,u,3),MMMM:c(u,o),D:this.$D,DD:y.s(this.$D,2,"0"),d:String(this.$W),dd:c(n.weekdaysMin,this.$W,l,2),ddd:c(n.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(s),HH:y.s(s,2,"0"),h:d(1),hh:d(2),a:p(s,a,!0),A:p(s,a,!1),m:String(a),mm:y.s(a,2,"0"),s:String(this.$s),ss:y.s(this.$s,2,"0"),SSS:y.s(this.$ms,3,"0"),Z:r};return i.replace(_,(function(e,t){return t||f[e]||r.replace(":","")}))},E.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},E.diff=function(n,d,h){var p,_=y.p(d),f=m(n),E=(f.utcOffset()-this.utcOffset())*e,I=this-f,g=y.m(this,f);return g=(p={},p[c]=g/12,p[l]=g,p[u]=g/3,p[o]=(I-E)/6048e5,p[a]=(I-E)/864e5,p[s]=I/t,p[r]=I/e,p[i]=I/1e3,p)[_]||I,h?g:y.a(g)},E.daysInMonth=function(){return this.endOf(l).$D},E.$locale=function(){return v[this.$L]},E.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),i=C(e,t,!0);return i&&(n.$L=i),n},E.clone=function(){return y.w(this.$d,this)},E.toDate=function(){return new Date(this.valueOf())},E.toJSON=function(){return this.isValid()?this.toISOString():null},E.toISOString=function(){return this.$d.toISOString()},E.toString=function(){return this.$d.toUTCString()},f}(),A=L.prototype;return m.prototype=A,[["$ms",n],["$s",i],["$m",r],["$H",s],["$W",a],["$M",l],["$y",c],["$D",d]].forEach((function(e){A[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),m.extend=function(e,t){return e.$i||(e(t,L,m),e.$i=!0),m},m.locale=C,m.isDayjs=T,m.unix=function(e){return m(1e3*e)},m.en=v[g],m.Ls=v,m.p={},m}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(30),r=n(14),s=n(69);t.default={TUICallEngine:i.default,TUICallEvent:r.TUICallEvent,TUICallType:s.TUICallType}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__decorate||function(e,t,n,i){var r,s=arguments.length,a=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(a=(s<3?r(a):s>3?r(t,n,a):r(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,i,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},l=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var s=arguments[t],a=0,o=s.length;a<o;a++,r++)i[r]=s[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var u=n(31),c=n(1),d=n(32),h=n(16),p=n(54),_=n(55),f=n(57),E=n(7),I=n(11),g=n(12),v=n(8),T=n(58),C=n(0),m=n(6),y=n(59),L=n(9),A=n(3),D=n(5),S=n(10),O=n(60),b=n(67),R=h,N=p,w=n(15),U="TUICallEngine",P=function(){function e(e){this._permission={audio:!1,video:!1},this._sdkAppID=e.SDKAppID,this._isLogin=!1,this._trtcClient=null,this._userID="",this._userSig="",this._switchCallModeStatus=!0,this._timExternal=!1,this._inviterInviteID={},this._audioVideoSwitchIdList=[],this._acceptedUserObject={},this._callTimeout=30,this._callStatus=m.CALL_STATUS.IDLE,this._callType=m.CALL_TYPE.UNKNOWN,this._roomID=0,this._isInviter=!1,this._isGroupCall=!1,this._groupCallStatus=!1,this._inviteeList=[],this._unHandledInviteeList=[],this._handledInviteeList=[],sessionStorage.setItem("sdkAppId",""+this._sdkAppID),this._localViewId="",this._netMonitor=new T.default,this._outerEmitter=new u.default,this._delegate=new f.default(this._outerEmitter),this._callDataReport=new b.CallDataReport({version:w.version,sdkAppId:e.SDKAppID}),this._dataReportObserver=new b.TUICallEngineObserver(this._outerEmitter,this._callDataReport),this._connectStartTime=0,e.tim&&(this._timExternal=!0),this.tim=e.tim||N.create(e),this._tsignalingClient=new _.default(this,i(i({tim:this.tim},e),{isRejectNotifyAll:!0})),this._quality="480p";var t=new E.default(I.default.SDK_CONSTRUCT);this._eventStatController=new g.default,E.default.bindController(this._eventStatController),t.setText("version="+w.version+"-ua="+v.USER_AGENT).setEnd(),C.default.info(U+" SDK Version:"+w.version+", SDKAppID:"+e.SDKAppID+", UserAgent:"+v.USER_AGENT)}return e.prototype.getDevicePermission=function(){return this._permission},e.prototype.setDevicePermission=function(e,t){this._permission[e]=t},e.prototype.getTrtcClient=function(){var e;return null===(e=this._trtcClient)||void 0===e?void 0:e.getClient()},e.prototype.getUserID=function(){return this._userID},e.prototype.setRoomID=function(e){this._roomID=e},e.prototype.getRoomID=function(){return this._roomID},e.prototype.getCallType=function(){return this._callType},e.prototype.setCallType=function(e){this._callType=e},e.prototype.isInviter=function(){return this._isInviter},e.prototype.setConnectStartTime=function(e){this._connectStartTime=e},e.prototype.getConnectStartTime=function(){return this._connectStartTime},e.prototype.getInviteeList=function(){return this._inviteeList},e.prototype.setInviteeList=function(e){this._inviteeList=l(e)},e.prototype.getCallDataReport=function(){return this._callDataReport},e.prototype.getUnHandledInviteeList=function(){return this._unHandledInviteeList||[]},e.prototype.setUnHandledInviteeList=function(e){this._unHandledInviteeList=l(e),C.default.log(U+".setUnHandledInviteeList",this._unHandledInviteeList)},e.prototype.addUnHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){-1===t._unHandledInviteeList.indexOf(e)&&t._unHandledInviteeList.push(e)}))},e.prototype.deleteUnHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){t._unHandledInviteeList=t._unHandledInviteeList.filter((function(t){return t!==e}))}))},e.prototype.getHandledInviteeList=function(){return this._handledInviteeList||[]},e.prototype.setHandledInviteeList=function(e){this._handledInviteeList=l(e),C.default.log(U+".setHandledInviteeList",this._handledInviteeList)},e.prototype.addHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){-1===t._handledInviteeList.indexOf(e)&&t._handledInviteeList.push(e)}))},e.prototype.deleteHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){t._handledInviteeList=t._handledInviteeList.filter((function(t){return t!==e}))}))},e.prototype.isGroupCall=function(){return this._isGroupCall},e.prototype.setIsGroupCall=function(e){this._isGroupCall=e},e.prototype.getGroupID=function(){return this._groupID},e.prototype.setGroupID=function(e){this._groupID=e},e.prototype.addAcceptedUserList=function(e,t){var n=this;if(0!==t.length)if(e)0===(this._acceptedUserObject[e]||[]).length?this._acceptedUserObject[e]=t:t.forEach((function(t){-1===n._acceptedUserObject[e].indexOf(t)&&n._acceptedUserObject[e].push(t)}));else for(var i=this.getInviterInviteIdList(),r=function(e){var r=i[e],a=s.getInviterInviteIdUserList(r),o=t.filter((function(e){return-1!==a.indexOf(e)}));0===(s._acceptedUserObject[r]||[]).length?s._acceptedUserObject[r]=o:o.forEach((function(e){-1===n._acceptedUserObject[r].indexOf(e)&&n._acceptedUserObject[r].push(e)}))},s=this,a=0;a<i.length;a++)r(a)},e.prototype.getAcceptedUserList=function(e){return this._acceptedUserObject[e]||[]},e.createInstance=function(t){return e.instance||(e.instance=new e(t)),e.instance},e.prototype.destroyInstance=function(){return a(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this._isLogin?[4,this.logout()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this._callDataReport.reset(),this._dataReportObserver.removeLister(),e.instance=null,[2]}}))}))},e.prototype.setLogLevel=function(e){C.default.setLevel(e),this._tsignalingClient.setLogLevel(e),R.Logger.setLogLevel(1)},e.prototype.on=function(e,t,n){this._outerEmitter.on(e,t,n||this)},e.prototype.off=function(e,t,n){this._outerEmitter.off(e,t,n||this)},e.prototype.init=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.login(e)]}))}))},e.prototype.login=function(e){return a(this,void 0,void 0,(function(){var t,n,i,r,s;return o(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),C.default.debug(U+".login - params:",e),this._netMonitor.start(),t=e.userID,n=e.userSig,i=e.assetsPath,this._userID=t,this._callDataReport.setUserID(t),this._userSig=n,this._trtcClient=new d.default({sdkAppID:this._sdkAppID,userID:t,userSig:n,tuiCallEngine:this,assetsPath:i}),sessionStorage.setItem("userId",""+this._userID),[4,this._tsignalingClient.login({userID:t,userSig:n})];case 1:return r=a.sent(),this._isLogin=!0,this._setInterfaceUpLoad(I.default.LOGIN).setText("userId: "+this._userID+" login succeeded, assetsPath: "+i).setEnd(),[2,r];case 2:throw s=a.sent(),this._setInterfaceUpLoad(I.default.LOGIN).setText("userId: "+this._userID+" login failed, error: "+s).setEnd(),new Error(U+".login - userId: "+this._userID+" login failed, error: "+s+" ");case 3:return[2]}}))}))},e.prototype.logout=function(){return a(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:C.default.debug(U+".logout"),this._setInterfaceUpLoad(I.default.LOGOUT).setText("userId: "+this._userID+" logout").setEnd(),this._userID="",this._userSig="",t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this._resetTUICallEngine()];case 2:return t.sent(),this._trtcClient=null,this._isLogin=!1,this._timExternal?[3,4]:[4,this._tsignalingClient.logout()];case 3:t.sent(),t.label=4;case 4:return[2,!0];case 5:throw e=t.sent(),new Error(U+".logout failed, error: "+e+" ");case 6:return[2]}}))}))},e.prototype.call=function(e){return a(this,void 0,void 0,(function(){var t,n,r,s,a,l,u,d,h,p;return o(this,(function(o){switch(o.label){case 0:C.default.log(U+".call - params:",e),this._callDataReport.setAbilityBit(!0),this._callDataReport.setCallScene(S.NAME.SINGLE_CALL),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._trtcClient.getMediaDevicesAuth({audio:!0})];case 2:return o.sent(),[3,4];case 3:throw t=o.sent(),this._delegate.onError(A.default.NOT_MEDIA_ACCESS,JSON.stringify(t)),this._callDataReport.setCodeAndMessage(A.default.NOT_MEDIA_ACCESS,JSON.stringify(t)),this._callDataReport.uploadToKibana(),new Error(U+".call failed. error: "+t);case 4:if(n=e.userID,r=e.type,s=e.offlinePushInfo,a=e.roomID,l=e.timeout,this.getUserID()===n)throw C.default.log(U+".call failed. Called id can't be yourself. userId:"+this.getUserID()+", inviteeId:"+n),new Error(U+".call failed. Called id can't be yourself. userId:"+this.getUserID()+", inviteeId:"+n);this._callStatus=m.CALL_STATUS.CALLING,this._callType=r,this._isInviter=!0,this._inviterID=this._userID,this._inviteeID=n,this._isGroupCall=!1,this._groupID="",this._roomID=a||c.generateRandomRoomID(),this._callTimeout=l||this._callTimeout,C.default.info("roomID:"+this._roomID),o.label=5;case 5:return o.trys.push([5,11,,13]),[4,this._trtcClient.join(this._roomID)];case 6:return o.sent(),this._callDataReport.setEnterRoomTime((new Date).getTime()),this._tsignalingClient.setTSignalingIsJoined(!0),u=this._callDataReport.getCallData(),u=i(i({},u),{roomID:this._roomID,callRole:m.CALL_ROLE.INVITER,callType:this._callType,inviteeList:[n]}),this._callDataReport.setCallData(u),[4,this._tsignalingClient.invite({userID:n,type:r,roomID:this._roomID,timeout:this._callTimeout,offlinePushInfo:s,userIDList:[n]})];case 7:return d=o.sent(),this._callDataReport.setSendSignalingTime((new Date).getTime()),this.setHandledInviteeList([this._userID]),this.setUnHandledInviteeList([n]),h="callType: "+(r+1)+",\n        conversationType: "+d.data.message.conversationType+", \n        userId:{ "+d.data.message.from+" } invite userId:{ "+d.data.message.to+" }",0!==d.code?[3,8]:(this.addInviterInviteId(d.inviteID,[this._userID,n]),this._callDataReport.setInviteID(d.inviteID),this._setInterfaceUpLoad(I.default.CALL).setCallType(r+1).setText(h+" succeeded").setEnd(),[3,10]);case 8:return this._callDataReport.setCodeAndMessage(d.code,d.message),this._callDataReport.uploadToKibana(),this._setInterfaceUpLoad(I.default.CALL).setCallType(r+1).setText(h+" failed").setEnd(),[4,this._resetTUICallEngine()];case 9:o.sent(),o.label=10;case 10:return[2,d];case 11:return(p=o.sent()).getCode?this._callDataReport.setCodeAndMessage(p.getCode(),p.message):this._callDataReport.setCodeAndMessage(A.default.UNKNOWN,JSON.stringify(p)),this._callDataReport.uploadToKibana(),[4,this._resetTUICallEngine()];case 12:throw o.sent(),new Error(U+".call failed, userId:"+this.getUserID()+", error: "+p);case 13:return[2]}}))}))},e.prototype.addAudioVideoSwitchIdList=function(e){e&&this._audioVideoSwitchIdList.push(e)},e.prototype.getAudioVideoSwitchIdList=function(){return this._audioVideoSwitchIdList||[]},e.prototype.addInviterInviteId=function(e,t){0!==t.length&&(0===(this._inviterInviteID[e]||[]).length?this._inviterInviteID[e]=t:this._inviterInviteID[e]=l(this._inviterInviteID[e],t))},e.prototype.getInviterInviteIdList=function(){return Object.keys(this._inviterInviteID||{})},e.prototype.getTotalInviterInviteIdList=function(){var e=this.getInviterInviteIdList();return l(this._audioVideoSwitchIdList,e)},e.prototype.getInviterInviteIdUserList=function(e){return this._inviterInviteID[e]||[]},e.prototype._setInterfaceUpLoad=function(e){return C.default.time(e),new E.default(e)},e.prototype.getInviterID=function(){return this._inviterID},e.prototype.setInviterID=function(e){this._inviterID=e},e.prototype.groupCall=function(e){var t;return a(this,void 0,void 0,(function(){var n,i,r,s,a,u,d,h,p,_;return o(this,(function(o){switch(o.label){case 0:if(0===(null===(t=null==e?void 0:e.userIDList)||void 0===t?void 0:t.length))throw new L.default({message:U+"<groupCall>: userIDList don'\t empty ",code:A.default.ERROR_PARAM_INVALID});if(this._groupCallStatus)throw new Error(U+".groupCall - CALL_STATUS: "+this._callStatus);this._groupCallStatus=!0,C.default.debug(U+".groupCall - params:",e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._trtcClient.getMediaDevicesAuth({audio:!0})];case 2:return o.sent(),[3,4];case 3:throw n=o.sent(),this._delegate.onError(A.default.NOT_MEDIA_ACCESS,JSON.stringify(n)),new Error(U+".groupCall failed. error: "+n);case 4:if(i=e.userIDList,r=e.type,s=e.groupID,a=e.offlinePushInfo,u=e.roomID,d=e.timeout,-1!==(i=l(i)).indexOf(this.getUserID()))throw C.default.log(U+".groupCall failed. Called list can't contain yourself. userId:"+this.getUserID()+", inviteeIdList:"+i),new Error(U+".groupCall failed. Called list can't contain yourself. userId:"+this.getUserID()+", inviteeIdList:"+i);this._callType=r,this._isInviter=!0,this._isGroupCall=!0,this._inviterID=this._userID,this._groupID=s||"",this.setInviteeList(i),this.setHandledInviteeList([this._userID]),this.setUnHandledInviteeList(i),this._roomID||(this._roomID=u||c.generateRandomRoomID(),this._callStatus=m.CALL_STATUS.CALLING),this._callTimeout=d||this._callTimeout,this._callDataReport.setCallScene(S.NAME.GROUP_CALL),o.label=5;case 5:return o.trys.push([5,8,,10]),[4,this._trtcClient.join(this._roomID)];case 6:return o.sent(),this._tsignalingClient.setTSignalingIsJoined(!0),[4,this._tsignalingClient.inviteInGroup({groupID:this._groupID,userIDList:i,type:r,roomID:this._roomID,timeout:this._callTimeout,offlinePushInfo:a})];case 7:return h=o.sent(),C.default.log("groupCall res",h),s&&(p="callType: "+(r+1)+",\n        conversationType: "+h.data.message.conversationType+",\n        userId:{ "+h.data.message.from+" } invite { "+h.data.message.to+": "+i+" }",0===h.code?(this.addInviterInviteId(h.inviteID,l([this._userID],i)),this._setInterfaceUpLoad(I.default.GROUP_CALL).setCallType(r+1).setText(p+"  succeeded").setEnd()):this._setInterfaceUpLoad(I.default.GROUP_CALL).setCallType(r+1).setText(p+"  failed").setEnd()),this._groupCallStatus=!1,[2,h];case 8:return _=o.sent(),[4,this._resetTUICallEngine()];case 9:throw o.sent(),new Error(U+".groupCall failed, userId:"+this.getUserID()+", error: "+_);case 10:return[2]}}))}))},e.prototype.joinInGroupCall=function(e){return a(this,void 0,void 0,(function(){var t,n,i,r,s;return o(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._trtcClient.getMediaDevicesAuth({audio:!0})];case 1:return a.sent(),[3,3];case 2:throw t=a.sent(),new Error(U+".joinInGroupCall failed, error: "+t);case 3:return a.trys.push([3,5,,7]),n=e.roomID,i=e.type,r=e.groupID,this._callType=i,this._groupID=r,this._roomID=n,this._isGroupCall=!0,this._isInviter=!1,this.addHandledInviteeList([this.getUserID()]),this.changeCallStatus(m.CALL_STATUS.CALLING),[4,this._trtcClient.join(n)];case 4:return a.sent(),C.default.log(U+".joinInGroupCall roomID:"+n+",type:"+i+",userID:"+this.getUserID()),[3,7];case 5:return s=a.sent(),[4,this._resetTUICallEngine()];case 6:throw a.sent(),new Error(U+".joinInGroupCall failed error: "+s);case 7:return[2]}}))}))},e.prototype.inviteUser=function(e){return a(this,void 0,void 0,(function(){var t,n,i,r,s,a,u,c,d,h,p,_=this;return o(this,(function(o){switch(o.label){case 0:if(!this.isGroupCall())throw C.default.error(U+".inviteUser failed - groupID:"+this._groupID+", roomID:"+this._roomID+", type:"+this._callType),new Error(U+".inviteUser failed - groupID:"+this._groupID+", roomID:"+this._roomID+", type:"+this._callType);if(!this.isInviter()&&this._callStatus!==m.CALL_STATUS.CONNECTED)throw C.default.error(U+".inviteUser failed - current status:"+this._callStatus+" not support"),new Error(U+".inviteUser failed - current status:"+this._callStatus+" not support");if(t=e.userIDList,n=void 0===t?[]:t,i=e.offlinePushInfo,0===n.length)throw C.default.error(U+".inviteUser failed - userIDList is empty"),new Error(U+".inviteUser failed - userIDList is empty");if(r=this.getHandledInviteeList(),s=this.getUnHandledInviteeList(),a=l(r,s),0===(u=n.filter((function(e){return-1===a.indexOf(e)}))).length)return C.default.error(U+".inviteUser failed - userIDList in call list. userIDList:"+JSON.stringify(n)+", call list:"+JSON.stringify(a)),[2,Promise.reject(U+".inviteUser failed - userIDList in call list. userIDList:"+JSON.stringify(n)+", call list:"+JSON.stringify(a))];n=u,o.label=1;case 1:return o.trys.push([1,3,,4]),c=this._handledInviteeList.filter((function(e){return e!==_._userID})),[4,this._tsignalingClient.inviteInGroup({groupID:this._groupID,userIDList:n,type:this._callType,roomID:this._roomID,timeout:this._callTimeout,inCallUserIDs:l(this._unHandledInviteeList,c),offlinePushInfo:i})];case 2:return d=o.sent(),C.default.log("inviteUser res",d),h="callType: "+(this._callType+1)+",\n      conversationType: "+d.data.message.conversationType+",\n      userId:{ "+d.data.message.from+" } invite { "+d.data.message.to+": "+n+" }",0===d.code?(this.addUnHandledInviteeList(n),this.addInviterInviteId(d.inviteID,l([this._userID],n)),this._setInterfaceUpLoad(I.default.GROUP_CALL).setCallType(this._callType+1).setText(h+"  succeeded").setEnd()):this._setInterfaceUpLoad(I.default.GROUP_CALL).setCallType(this._callType+1).setText(h+"  failed").setEnd(),[2,d];case 3:throw p=o.sent(),new Error(U+".inviteUser failed, userId:"+this.getUserID()+", inviteeIdList:"+n+", error: "+p);case 4:return[2]}}))}))},e.prototype.accept=function(){return a(this,void 0,void 0,(function(){var e,t,n,r,s,a,l,u,c,d,h;return o(this,(function(o){switch(o.label){case 0:if(C.default.debug(U+".accept"),this.getCallStatus()===m.CALL_STATUS.CONNECTED)return C.default.warn(U+".accept - already connected, avoid repeat accept"),[2];if(!this._tsignalingClient.getInviteData())return C.default.warn(U+".accept - there are no calls to accept"),[2];this._callDataReport.setCallAcceptTime((new Date).getTime()),o.label=1;case 1:return o.trys.push([1,5,,6]),[4,this._trtcClient.getMediaDevicesAuth({audio:!0})];case 2:return o.sent().audio?[3,4]:[4,this._resetTUICallEngine()];case 3:o.sent(),o.label=4;case 4:return[3,6];case 5:throw e=o.sent(),this.isGroupCall()&&(this._callDataReport.setCodeAndMessage(A.default.NOT_MEDIA_ACCESS,JSON.stringify(e)),this._callDataReport.uploadToKibana()),new Error(U+".accept failed, error: "+e);case 6:t=this._tsignalingClient.getInviteData(),n=t.inviteID,r=t.inviteData,s=r.roomID,a=r.callType,C.default.debug(U+".accept - params","inviteID: "+n+",callType: "+a+",roomID: "+s+"."),this._callType=a,this._callStatus=m.CALL_STATUS.CALLING,console.log("accept roomId: "+s),l={},o.label=7;case 7:return o.trys.push([7,9,,11]),this._callDataReport.setEnterRoomTime((new Date).getTime()),[4,this._trtcClient.join(s)];case 8:return l=o.sent(),this.addHandledInviteeList([this.getUserID()]),this.deleteUnHandledInviteeList([this.getUserID()]),this.addAcceptedUserList(n,[this.getUserID()]),this._tsignalingClient.setInviteData(null),this.changeCallStatus(m.CALL_STATUS.CONNECTED),[3,11];case 9:return u=o.sent(),this.isGroupCall()||(u.getCode?this._callDataReport.setCodeAndMessage(u.getCode(),u.message):this._callDataReport.setCodeAndMessage(A.default.UNKNOWN,JSON.stringify(u)),this._callDataReport.uploadToKibana()),[4,this._resetTUICallEngine()];case 10:throw o.sent(),new Error(U+".accept failed, error: "+u);case 11:l=i(i({},l),{roomID:s,callType:a}),o.label=12;case 12:return o.trys.push([12,14,,16]),[4,this._tsignalingClient.accept({inviteID:n,callType:a})];case 13:return c=o.sent(),h="callType: "+(a+1)+",\n      conversationType: "+c.data.message.conversationType+",\n      userId:{ "+this._userID+" } accept userId:{ "+c.data.message.to+" } succeeded",this._setInterfaceUpLoad(I.default.ACCEPT).setCallType(a+1).setText(""+h).setEnd(),[3,16];case 14:return d=o.sent(),C.default.error(d),[4,this._resetTUICallEngine()];case 15:throw o.sent(),h="callType: "+(a+1)+",\n      conversationType: "+c.data.message.conversationType+",\n      userId:{ "+this._userID+" } accept userId:{ "+c.data.message.to+" } failed",this._setInterfaceUpLoad(I.default.ACCEPT).setCallType(a+1).setText(""+h).setEnd(),this.isGroupCall()||(this._callDataReport.setCodeAndMessage(A.default.UNKNOWN,JSON.stringify(d)),this._callDataReport.uploadToKibana()),new Error(U+".accept failed, error: "+d);case 16:return this.isGroupCall()&&(h="callType: "+(a+1)+",\n      conversationType: "+c.data.message.conversationType+",\n      userId:{ "+this._userID+" } accept userId:{ "+c.data.message.to+" } succeeded",this._setInterfaceUpLoad(I.default.ACCEPT).setCallType(a+1).setText(h).setEnd()),[2,i(i({},l),c)]}}))}))},e.prototype.reject=function(){return a(this,void 0,void 0,(function(){var e,t,n,i,r,s,a,l;return o(this,(function(o){switch(o.label){case 0:if(!this._tsignalingClient.getInviteData())return C.default.warn(U+".reject - there are no calls to reject"),[2];e=this._callStatus===m.CALL_STATUS.CONNECTED,t=this._tsignalingClient.getInviteData(),n=t.inviteID,i=t.inviteData,r=i.callType,C.default.warn(U+".reject - params","inviteID: "+n+",callType: "+r+",isBusy: "+e+"."),o.label=1;case 1:return o.trys.push([1,5,,6]),[4,this._tsignalingClient.reject({inviteID:n,callType:r,isBusy:e})];case 2:return s=o.sent(),a="callType: "+(r+1)+",\n      conversationType: "+s.data.message.conversationType+",\n      userId:{ "+this._userID+" } reject userId:{ "+s.data.message.to+" } succeeded",this._setInterfaceUpLoad(I.default.REJECT).setCallType(r+1).setText(a).setEnd(),e?[3,4]:[4,this._resetTUICallEngine()];case 3:o.sent(),this._delegate.onCallingCancel(this._userID),o.label=4;case 4:return[2,s];case 5:throw l=o.sent(),new Error(U+".reject failed, error: "+l);case 6:return[2]}}))}))},e.prototype.hangup=function(){return a(this,void 0,void 0,(function(){var e,t,n,i,r,s,a,u,c,d,h,p,_,f,E,g,v,T,y;return o(this,(function(L){switch(L.label){case 0:if(C.default.warn(U+". - callStatus:"+this._callStatus+" _inviterInviteID:"+JSON.stringify(this._acceptedUserObject)),this._callStatus===m.CALL_STATUS.IDLE)throw new Error(U+".hangup failed. current status:"+this._callStatus);if(this._callStatus===m.CALL_STATUS.CALLING&&0===this.getInviterInviteIdList().length)throw new Error(U+".call/groupCall incomplete。please wait cancel");if(e=this.isGroupCall(),t=this.isInviter(),n=this.getUserID(),i=Math.round((Date.now()-this.getConnectStartTime())/1e3),r=this.getCallType(),a=this.getInviterInviteIdList(),this._callStatus!==m.CALL_STATUS.CONNECTED)return[3,8];L.label=1;case 1:return L.trys.push([1,5,,7]),[4,this._trtcClient.leave()];case 2:return L.sent(),0!==a.length?[3,4]:(h=this.generateCallEndData({callMediaType:r,totalTime:i}),this._delegate.onCallEnd(h),[4,this._resetTUICallEngine()]);case 3:L.sent(),L.label=4;case 4:return[3,7];case 5:return u=L.sent(),[4,this._resetTUICallEngine()];case 6:throw L.sent(),new Error(u);case 7:this._setInterfaceUpLoad(I.default.REJECT).setText("userId: "+this._userID+" hangup succeeded").setEnd(),L.label=8;case 8:c=this.getHandledInviteeList(),d=this.getUnHandledInviteeList(),L.label=9;case 9:return L.trys.push([9,31,,32]),e?[3,16]:(h=this.generateCallEndData(),t?1!==d.length?[3,11]:[4,this._cancel()]:[3,13]);case 10:return s=L.sent(),this._delegate.onCallingCancel(n),[3,12];case 11:this._delegate.onCallEnd(h),L.label=12;case 12:return[3,14];case 13:this._delegate.onCallEnd(h),L.label=14;case 14:return[4,this._resetTUICallEngine()];case 15:return L.sent(),[3,30];case 16:return p=this.getCallStatus(),_={callType:r,userIDList:l(c.filter((function(e){return e!==n})),d),callEnd:i},t?p!==m.CALL_STATUS.CALLING?[3,19]:[4,this._cancel(this.getInviterInviteIdList())]:[3,24];case 17:return s=L.sent(),[4,this._resetTUICallEngine()];case 18:L.sent(),this._delegate.onCallingCancel(n),L.label=19;case 19:if(p!==m.CALL_STATUS.CONNECTED)return[3,23];f=function(e){var t,i,r,u,h,p;return o(this,(function(o){switch(o.label){case 0:return t=a[e],i=E.getInviterInviteIdUserList(t),(r=E.getAcceptedUserList(t)).length>0?(u=r.filter((function(e){return-1!==c.indexOf(e)})),h=i.filter((function(e){return-1!==d.indexOf(e)})),_.userIDList=l(u,h).filter((function(e){return e!==n})),C.default.warn("inviter emit hangup signal, notify userIDList:"+JSON.stringify(_.userIDList)),[4,E._tsignalingClient.hangup(_)]):[3,2];case 1:return s=o.sent(),[3,4];case 2:return p=E.getUnHandledInviteeList(),i.filter((function(e){return-1!==p.indexOf(e)})).length>0?(C.default.warn("inviter emit cancel signal, userIdList:"+i),[4,E._cancel([t])]):[3,4];case 3:s=o.sent(),o.label=4;case 4:return[2]}}))},E=this,T=0,L.label=20;case 20:return T<a.length?[5,f(T)]:[3,23];case 21:L.sent(),L.label=22;case 22:return T++,[3,20];case 23:return[3,28];case 24:g=function(e){var t,i,r,u,h,p;return o(this,(function(o){switch(o.label){case 0:return t=a[e],i=v.getInviterInviteIdUserList(t),(r=v.getAcceptedUserList(t)).length>0?(u=r.filter((function(e){return-1!==c.indexOf(e)})),h=i.filter((function(e){return-1!==d.indexOf(e)})),_.userIDList=l(u,h).filter((function(e){return e!==n})),C.default.warn("invitee emit hangup signal, notify userIDList:"+JSON.stringify(_.userIDList)),[4,v._tsignalingClient.hangup(_)]):[3,2];case 1:return s=o.sent(),[3,4];case 2:return p=v.getUnHandledInviteeList(),i.filter((function(e){return-1!==p.indexOf(e)})).length>0?(C.default.warn("invitee emit cancel signal, inviteID:"+t),[4,v._cancel([t])]):[3,4];case 3:s=o.sent(),o.label=4;case 4:return[2]}}))},v=this,T=0,L.label=25;case 25:return T<a.length?[5,g(T)]:[3,28];case 26:L.sent(),L.label=27;case 27:return T++,[3,25];case 28:return[4,this._resetTUICallEngine()];case 29:L.sent(),L.label=30;case 30:return[2,s];case 31:throw y=L.sent(),C.default.warn(U+".hangup failed, error: "+y),new Error(U+".hangup failed, error: "+y);case 32:return[2]}}))}))},e.prototype._cancel=function(e){return a(this,void 0,void 0,(function(){var t,n,i,r,s,a;return o(this,(function(o){switch(o.label){case 0:C.default.log("_cancel _inviterInviteID",this._inviterInviteID),t=[],o.label=1;case 1:o.trys.push([1,6,,7]),0===(e||[]).length&&(e=this.getInviterInviteIdList().slice(0,1)),n=0,o.label=2;case 2:return n<e.length?(i=e[n],[4,this._tsignalingClient.cancel({inviteID:i})]):[3,5];case 3:r=o.sent(),t.push(r),o.label=4;case 4:return n++,[3,2];case 5:return[3,7];case 6:throw s=o.sent(),new Error(U+"._cancel failed, error: "+s);case 7:return a="cancel "+JSON.stringify(t)+" succeeded",C.default.log(U+"._cancel "+a),this._setInterfaceUpLoad(I.default.CALLING_CANCEL).setText(a).setEnd(),[2,t]}}))}))},e.prototype.startRemoteView=function(e){return a(this,void 0,void 0,(function(){var t,n,i;return o(this,(function(r){return C.default.debug(U+".startRemoteView - params:",e),t=e.userID,n=e.videoViewDomID,i=e.options,this._setInterfaceUpLoad(I.default.START_REMOTE_VIEW).setText("remote userId:{ "+t+" } startRemoveView succeeded").setEnd(),[2,this._trtcClient.playRemoteVideo({videoViewDomID:n,userID:t,options:i})]}))}))},e.prototype.stopRemoteView=function(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(n){return C.default.debug(U+".stopRemoteView - params:",e),t=e.userID,this._setInterfaceUpLoad(I.default.STOP_REMOTE_VIEW).setText("remote userId:{ "+t+" } stopRemoveView succeeded").setEnd(),[2,this._trtcClient.stopRemoteVideo({userID:t})]}))}))},e.prototype.startLocalView=function(e){return a(this,void 0,void 0,(function(){var t,n,i,r;return o(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),C.default.debug(U+".startLocalView - params:",e),t=e.userID,n=e.videoViewDomID,i=e.options,this._localViewId=n,this._setInterfaceUpLoad(I.default.START_LOCAL_VIEW).setText("remote userId:{ "+t+" } startLocalView succeeded").setEnd(),[4,this._trtcClient.playLocalVideo({videoViewDomID:n,userID:t,options:i})];case 1:return s.sent(),[3,3];case 2:throw r=s.sent(),new Error(U+".startLocalView failed. error: "+r);case 3:return[2]}}))}))},e.prototype.stopLocalView=function(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(n){return C.default.debug(U+".stopLocalView - params:",e),t=e.userID,this._localViewId="",this._setInterfaceUpLoad(I.default.STOP_LOCAL_VIEW).setText("remote userId:{ "+t+" } stopLocalView succeeded").setEnd(),[2,this._trtcClient.stopLocalVideo()]}))}))},e.prototype.openCamera=function(e){return a(this,void 0,void 0,(function(){var t,n,i;return o(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,3,,4]),t=e,!e){if(!this._localViewId)return C.default.error(U+".openCamera failed. error: A DOM parameter is required to render the camera data"),[2];C.default.warn(U+".openCamera warning. warn: A DOM parameter is required to render the camera data. "+U+".startLocalView() will be deprecated soon."),t=this._localViewId}return[4,this._trtcClient.getMediaDevicesAuth({video:!0,isThrowVideoError:!0})];case 1:return r.sent(),n={videoViewDomID:t,userID:this.getUserID()},[4,this._trtcClient.playLocalVideo(n)];case 2:return r.sent(),[3,4];case 3:throw i=r.sent(),C.default.error(U+".openCamera failed. error: "+i),new Error(U+".openCamera failed. error: "+i);case 4:return[2]}}))}))},e.prototype.closeCamera=function(){return a(this,void 0,void 0,(function(){return o(this,(function(e){try{return this._setInterfaceUpLoad(I.default.CLOSE_CAMERA).setText("close camera").setEnd(),[2,this._trtcClient.stopLocalVideo()]}catch(e){throw new Error(U+".closeCamera failed. error: "+e)}return[2]}))}))},e.prototype.openMicrophone=function(){return a(this,void 0,void 0,(function(){return o(this,(function(e){return this._setInterfaceUpLoad(I.default.SET_MIC_MUTE).setText("openMicrophone").setEnd(),[2,this._trtcClient.unMuteLocalAudio()]}))}))},e.prototype.closeMicrophone=function(){return a(this,void 0,void 0,(function(){return o(this,(function(e){return this._setInterfaceUpLoad(I.default.SET_MIC_MUTE).setText("closeMicrophone").setEnd(),[2,this._trtcClient.muteLocalAudio()]}))}))},e.prototype.setVideoQuality=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(t){if(!y.isString(e)&&!y.isPlainObject(e)||y.isString(e)&&-1===m.VALID_VIDEO_PROFILE_LIST.indexOf(e.toString()))throw new L.default({message:U+"<setVideoQuality>: 'params validate failed.",code:A.default.ERROR_PARAM_INVALID});return C.default.debug(U+".setVideoQuality - quality:"+JSON.stringify(e)),this._setInterfaceUpLoad(I.default.SET_VIDEO_QUALITY).setText("setVideoQuality: "+JSON.stringify(e)).setEnd(),[2,this._quality=e||"480p"]}))}))},e.prototype.getVideoQuality=function(){return this._quality},e.prototype.switchCallMediaType=function(e){return a(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:if(this._callType===e)throw new L.default({message:U+"<switchCallMediaType>: "+D.default.ERROR_REQUEST_REPEATED_SWITCH,code:A.default.ERROR_REQUEST_REPEATED});if(!this._switchCallModeStatus)throw new Error(U+" audio and video call switching.");C.default.log(U+".switchCallMediaType",this._inviterID,this._inviteeID),this._setInterfaceUpLoad(I.default.SWITCH_TO_AUDIO_CALL).setText("switchCallMediaType").setEnd(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._tsignalingClient.switchCallMode({userID:this._isInviter?this._inviteeID:this._inviterID,callType:this._callType,roomID:this._roomID,timeout:this._callTimeout,mode:e===m.CALL_TYPE.AUDIO_CALL?m.MODE_TYPE.AUDIO:m.MODE_TYPE.VIDEO})];case 2:return n.sent(),this.setSwitchCallModeStatus(!1),[3,4];case 3:throw t=n.sent(),new Error(U+".switchCallMediaType failed, error: "+t);case 4:return[2]}}))}))},e.prototype.setSwitchCallModeStatus=function(e){this._switchCallModeStatus=e},e.prototype.getSwitchCallModeStatus=function(){return this._switchCallModeStatus},e.prototype.getDeviceList=function(e){return a(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:if(e!==m.DEVICE_TYPE.CAMERA)return[3,5];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,this._trtcClient.getMediaDevicesAuth({video:!0,isThrowVideoError:!0})];case 2:return t.sent(),[4,R.getCameras()];case 3:return[2,t.sent()];case 4:throw t.sent(),new L.default({message:D.default.ERROR_PERMISSION_DENIED,code:A.default.ERROR_PERMISSION_DENIED});case 5:if(e!==m.DEVICE_TYPE.MICROPHONES)return[3,10];t.label=6;case 6:return t.trys.push([6,9,,10]),[4,this._trtcClient.getMediaDevicesAuth({audio:!0})];case 7:return t.sent(),[4,R.getMicrophones()];case 8:return[2,t.sent()];case 9:throw t.sent(),new L.default({message:D.default.ERROR_PERMISSION_DENIED,code:A.default.ERROR_PERMISSION_DENIED});case 10:return[2]}}))}))},e.prototype.switchDevice=function(e){return a(this,void 0,void 0,(function(){var t,n;return o(this,(function(i){return t=e.deviceType,n=e.deviceId,C.default.debug(U+".switchDevice -params: deviceType:"+t+",deviceID:"+n),[2,this._trtcClient.switchDevice(t,n)]}))}))},e.prototype.setSelfInfo=function(e){return a(this,void 0,void 0,(function(){var t,n,i;return o(this,(function(r){return t=e.nickName,n=e.avatar,i={nick:t,avatar:n},!t&&delete i.nick,!n&&delete i.avatar,C.default.log(U+".setSelfInfo -params: nickName:"+i.nick+",avatar:"+i.avatar),[2,this.tim.updateMyProfile(i)]}))}))},e.prototype.generateCallEndData=function(e){var t=e||{},n=t.roomId,i=t.callMediaType,r=t.callRole,s=t.totalTime,a=t.userId;return n=n||this.getRoomID(),i=i||this.getCallType(),r||(r=this.isInviter()?m.CALL_ROLE.INVITER:m.CALL_ROLE.INVITEE),{roomID:n,callMediaType:i,callRole:r,totalTime:s=c.isUndefined(s)?Math.round((Date.now()-this.getConnectStartTime())/1e3):s,userID:a=a||this.getUserID()}},e.prototype.enableAIVoice=function(e){var t;return a(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return this._trtcClient?[4,null===(t=this._trtcClient)||void 0===t?void 0:t.enableAIVoice(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},e.prototype._resetTUICallEngine=function(){var e;return a(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return C.default.debug(U+"._resetTUICallEngine"),this._roomID=0,this._isInviter=!1,this._isGroupCall=!1,this.setSwitchCallModeStatus(!0),this._groupID="",this._callStatus=m.CALL_STATUS.IDLE,this._inviteeList=[],this._unHandledInviteeList=[],this._handledInviteeList=[],this._inviterInviteID={},this._audioVideoSwitchIdList=[],this._acceptedUserObject={},this._connectStartTime=0,this._switchCallModeStatus=!0,this._localViewId="",[4,null===(e=this._trtcClient)||void 0===e?void 0:e.reset()];case 1:return n.sent(),this._tsignalingClient.setInviteData(null),this._tsignalingClient.resetJoined(),(t=document.getElementById("_trtc_calling_layer"))&&(t.innerHTML=""),[2]}}))}))},e.prototype.getCallStatus=function(){return this._callStatus},e.prototype.changeCallStatus=function(e){this._callStatus!==e&&(C.default.debug(U+".changeCallStatus from "+this._callStatus+" to "+e),this._setInterfaceUpLoad(I.default.CHANGE_CALL_STATUS).setText("changeCallStatus from "+this._callStatus+" to "+e).setEnd(),this._callStatus=e)},e.prototype.extractCallingInfoFromMessage=function(e){if(!e)return"";if("TIMCustomElem"!==e.type)return"";var t=JSON.parse(e.payload.data);if(C.default.debug(U+".extractCallingInfoFromMessage - signalingData:",e.payload.data),t.businessID!==m.BUSINESS_ID.SIGNAL)return"";switch(t.actionType){case m.ACTION_TYPE.INVITE:var n=JSON.parse(t.data);return n.call_end>0?"结束通话，通话时长："+c.formatDuration(n.call_end):0!==n.call_end&&n.room_id?"发起通话":"结束群聊";case m.ACTION_TYPE.CANCEL_INVITE:return"取消通话";case m.ACTION_TYPE.ACCEPT_INVITE:return"已接听";case m.ACTION_TYPE.REJECT_INVITE:return"拒绝通话";case m.ACTION_TYPE.INVITE_TIMEOUT:return"无应答";default:return""}},e.CALL_TYPE=m.CALL_TYPE,r([O.paramValidate(O.VALIDATE_PARAMS.login),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"init",null),r([O.paramValidate(O.VALIDATE_PARAMS.login),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"login",null),r([O.avoidRepeatedCall(),O.paramValidate(O.VALIDATE_PARAMS.call),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.IDLE]}),O.businessValidate(m.CALL_EXPERMENTEL_API_TYPE.BASE),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"call",null),r([O.avoidRepeatedCall(),O.paramValidate(O.VALIDATE_PARAMS.groupCall),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.IDLE]}),O.businessValidate(m.CALL_EXPERMENTEL_API_TYPE.PRO),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"groupCall",null),r([O.paramValidate(O.VALIDATE_PARAMS.joinInGroupCall),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.IDLE]}),O.businessValidate(m.CALL_EXPERMENTEL_API_TYPE.PRO),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"joinInGroupCall",null),r([O.paramValidate(O.VALIDATE_PARAMS.inviteUser),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),O.businessValidate(m.CALL_EXPERMENTEL_API_TYPE.PRO),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"inviteUser",null),r([O.avoidRepeatedCall(),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING]}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],e.prototype,"accept",null),r([O.avoidRepeatedCall(),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING]}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],e.prototype,"reject",null),r([O.avoidRepeatedCall(),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],e.prototype,"hangup",null),r([O.paramValidate(O.VALIDATE_PARAMS.startRemoteView),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CONNECTED]}),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"startRemoteView",null),r([O.paramValidate(O.VALIDATE_PARAMS.stopRemoteView),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CONNECTED]}),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"stopRemoteView",null),r([O.paramValidate(O.VALIDATE_PARAMS.startLocalView),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),O.apiCallQueue(),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"startLocalView",null),r([O.paramValidate(O.VALIDATE_PARAMS.stopLocalView),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),O.apiCallQueue(),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"stopLocalView",null),r([O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"openCamera",null),r([O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],e.prototype,"closeCamera",null),r([O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],e.prototype,"openMicrophone",null),r([O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],e.prototype,"closeMicrophone",null),r([O.paramValidate(O.VALIDATE_PARAMS.switchCallMediaType),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CONNECTED,m.CALL_STATUS.CALLING],scene:!0}),s("design:type",Function),s("design:paramtypes",[Number]),s("design:returntype",Promise)],e.prototype,"switchCallMediaType",null),r([O.paramValidate(O.VALIDATE_PARAMS.getDeviceList),O.statusValidate({init:!0}),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],e.prototype,"getDeviceList",null),r([O.paramValidate(O.VALIDATE_PARAMS.switchDevice),O.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"switchDevice",null),r([O.paramValidate(O.VALIDATE_PARAMS.setSelfInfo),O.statusValidate({init:!0}),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],e.prototype,"setSelfInfo",null),r([O.statusValidate({init:!0}),s("design:type",Function),s("design:paramtypes",[Boolean]),s("design:returntype",Promise)],e.prototype,"enableAIVoice",null),r([O.paramValidate(O.VALIDATE_PARAMS.createInstance),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],e,"createInstance",null),e}();t.default=P},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));const i=Function.prototype.apply,r=new WeakMap;function s(e){return r.has(e)||r.set(e,{}),r.get(e)}class a{constructor(e=null,t=console){const n=s(this);return n._events=new Set,n._callbacks={},n._console=t,n._maxListeners=null===e?null:parseInt(e,10),this}_addCallback(e,t,n,i){return this._getCallbacks(e).push({callback:t,context:n,weight:i}),this._getCallbacks(e).sort((e,t)=>e.weight>t.weight),this}_getCallbacks(e){return s(this)._callbacks[e]}_getCallbackIndex(e,t){return this._has(e)?this._getCallbacks(e).findIndex(e=>e.callback===t):null}_achieveMaxListener(e){return null!==s(this)._maxListeners&&s(this)._maxListeners<=this.listenersNumber(e)}_callbackIsExists(e,t,n){const i=this._getCallbackIndex(e,t),r=-1!==i?this._getCallbacks(e)[i]:void 0;return-1!==i&&r&&r.context===n}_has(e){return s(this)._events.has(e)}on(e,t,n=null,i=1){const r=s(this);if("function"!=typeof t)throw new TypeError(t+" is not a function");return this._has(e)?(this._achieveMaxListener(e)&&r._console.warn(`Max listeners (${r._maxListeners}) for event "${e}" is reached!`),this._callbackIsExists(...arguments)&&r._console.warn(`Event "${e}" already has the callback ${t}.`)):(r._events.add(e),r._callbacks[e]=[]),this._addCallback(...arguments),this}once(e,t,n=null,r=1){const s=(...r)=>(this.off(e,s),i.call(t,n,r));return this.on(e,s,n,r)}off(e,t=null){const n=s(this);let i;return this._has(e)&&(null===t?(n._events.delete(e),n._callbacks[e]=null):(i=this._getCallbackIndex(e,t),-1!==i&&(n._callbacks[e].splice(i,1),this.off(...arguments)))),this}emit(e,...t){return this._has(e)&&this._getCallbacks(e).forEach(e=>i.call(e.callback,e.context,t)),this}clear(){const e=s(this);return e._events.clear(),e._callbacks={},this}listenersNumber(e){return this._has(e)?this._getCallbacks(e).length:null}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var s=arguments[t],a=0,o=s.length;a<o;a++,r++)i[r]=s[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),o=n(0),l=n(6),u=n(1),c=n(7),d=n(11),h=n(12),p=n(3),_=n(5),f=n(6),E=n(53),I=n(25),g=n(10),v=n(10),T="TRTCClient",C=a,m=function(){function e(e){var t,n=this;this._sdkAppID=e.sdkAppID,this._userID=e.userID,this._userSig=e.userSig,this._tuiCallEngine=e.tuiCallEngine,this._videoAvailableMap=new Map,this._isJoined=!1,this._isPublished=!1,this._unpublishing=!1,this._localStream=null,this._remoteStreams=[],this._device={video:null,audio:null,microphoneList:[],cameraList:[]},this._prevDevices=[],this._displayLocalStream=null,this._isMuteAudioVideo=!1,this._assetsPath=e.assetsPath,this._eventStatController=new h.default,c.default.bindController(this._eventStatController),this._isAiNoiseSuppress=!0;var i=C.VERSION;u.compareVersion(i,"4.7.0")>=0?C.checkSystemRequirements().then((function(e){if(!e.result)throw n._tuiCallEngine._delegate.onError(p.default.NOT_SUPPORT,JSON.stringify(e)),new Error(T+".当前页面不具备 webRTC 能力"+JSON.stringify(e))})):C.checkSystemRequirements().then((function(e){if(!e)throw n._tuiCallEngine._delegate.onError(p.default.NOT_SUPPORT,e),new Error(T+".当前页面不具备 webRTC 能力"+JSON.stringify(e))})),this._frameWorkType=32,u.compareVersion(i,"4.15.1")>=0?(this._frameWorkType=30,this._component=14,((null===(t=null===window||void 0===window?void 0:window.localStorage)||void 0===t?void 0:t.getItem("_isTIMCallKit"))||(null===window||void 0===window?void 0:window._isTIMCallKit))&&(this._component=15)):this._component=3,this.init()}return e.prototype.init=function(){this._client=C.createClient({mode:v.NAME.RTC,sdkAppId:this._sdkAppID,userId:this._userID,userSig:this._userSig,frameWorkType:this._frameWorkType,component:this._component}),this.handleEvents()},e.prototype.getClient=function(){return this._client},e.prototype.getRemoteStreams=function(){return this._remoteStreams},e.prototype.getMicrophoneList=function(){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,C.getMicrophones()];case 1:return e=t.sent(),this._device.microphoneList=e,[2]}}))}))},e.prototype.getCamerasList=function(){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,C.getCameras()];case 1:return e=t.sent(),this._device.cameraList=e,[2]}}))}))},e.prototype.getDevices=function(e){return i(this,void 0,void 0,(function(){var t=this;return r(this,(function(n){switch(n.label){case 0:return[4,this.getMicrophoneList()];case 1:return n.sent(),0!==this._device.microphoneList.length?[3,3]:[4,this._tuiCallEngine._resetTUICallEngine()];case 2:return n.sent(),this._tuiCallEngine._delegate.onError(p.default.NOT_MICROPHONE_LIST,_.default.NOT_MICROPHONE_LIST),[2];case 3:return this._device.audio=JSON.parse(JSON.stringify(this._device.microphoneList[0])),e===l.CALL_TYPE.VIDEO_CALL&&this._tuiCallEngine.getDevicePermission().video?[4,this.getCamerasList()]:[3,5];case 4:n.sent(),this._device.video=JSON.parse(JSON.stringify(this._device.cameraList[0])),n.label=5;case 5:return this._prevDevices.length>0||(this._prevDevices=s(this._device.microphoneList,this._device.cameraList),navigator.mediaDevices.addEventListener("devicechange",(function(){return i(t,void 0,void 0,(function(){var e,t,n,i,a,o=this;return r(this,(function(r){switch(r.label){case 0:return[4,C.getMicrophones()];case 1:return e=r.sent(),[4,C.getCameras()];case 2:return t=r.sent(),n=s(e,t),this.setDevcies(n),i=n.filter((function(e){return o._prevDevices.findIndex((function(t){var n=t.deviceId;return e.deviceId===n}))<0})),a=this._prevDevices.filter((function(e){return n.findIndex((function(t){var n=t.deviceId;return e.deviceId===n}))<0})),i.length>0&&this.handleDevices(i),a.length>0&&this.handleDevicesRemoved(a),this._tuiCallEngine._delegate.onDeviceUpdated(this._device.microphoneList,this._device.cameraList,this._device.audio,this._device.video),this._prevDevices=n,[2]}}))}))}))),[2]}}))}))},e.prototype.setDevcies=function(e){this._device.microphoneList=e.filter((function(e){return e.kind===v.NAME.AUDIO_INPUT}))||[],this._device.cameraList=e.filter((function(e){return e.kind===v.NAME.VIDEO_INPUT}))||[]},e.prototype.handleDevices=function(e,t){var n=this;e.forEach((function(e){e.kind===v.NAME.AUDIO_INPUT?n.switchDevice(l.DEVICE_TYPE.AUDIO,e.deviceId):e.kind===v.NAME.VIDEO_INPUT&&t&&n.switchDevice(l.DEVICE_TYPE.VIDEO,e.deviceId)}))},e.prototype.handleDevicesRemoved=function(e){var t=this;e.forEach((function(e){e.kind===v.NAME.AUDIO_INPUT?t.isCurrentMicrophoneRemoved(e.deviceId)&&t.handleDevices(t._prevDevices):e.kind===v.NAME.VIDEO_INPUT&&t.isCurrentCameraRemoved(e.deviceId)&&t.handleDevices(t._prevDevices,!0)}))},e.prototype.isCurrentMicrophoneRemoved=function(e){var t=this._localStream.getAudioTrack();return!(!t||t.getSettings().deviceId!==e)},e.prototype.isCurrentCameraRemoved=function(e){var t=this._localStream.getVideoTrack();return!(!t||t.getSettings().deviceId!==e)},e.prototype.switchDevice=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return o.default.log(T+".switchDevice - params: deviceType:"+e+",deviceID:"+t),this._localStream?[4,this._localStream.switchDevice(e,t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return this._displayLocalStream?[4,this._displayLocalStream.switchDevice(e,t)]:[3,4];case 3:i.sent(),i.label=4;case 4:return n={deviceType:e,deviceId:t},this._device[e]=n,this._tuiCallEngine._delegate.onDeviceUpdated(this._device.microphoneList,this._device.cameraList,this._device.audio,this._device.video),[2]}}))}))},e.prototype.join=function(e){return i(this,void 0,void 0,(function(){var t,n,i,s;return r(this,(function(r){switch(r.label){case 0:return(t=this.getCallType())!==l.CALL_TYPE.VIDEO_CALL||this._tuiCallEngine.getDevicePermission().video?[3,2]:[4,this.getMediaDevicesAuth({video:!0})];case 1:r.sent(),r.label=2;case 2:return[4,this.getDevices(t)];case 3:if(r.sent(),this._isJoined)return o.default.warn(T+".join - duplicate RtcClient.join() observed"),[2];r.label=4;case 4:return r.trys.push([4,6,,7]),[4,this._client.join({roomId:e})];case 5:return r.sent(),this._isJoined=!0,o.default.log(T+".join - join room success, callType:"+t),[3,7];case 6:throw n=r.sent(),o.default.error(T+".join - join room failed! "+n),new Error(T+".join - join room failed! "+n);case 7:if(this._tuiCallEngine.getCallStatus()===l.CALL_STATUS.IDLE)return o.default.warn(T+".join - early hangup"),[2,this._tuiCallEngine.hangup()];i={audio:!0,video:!1,userId:this._userID},t===l.CALL_TYPE.VIDEO_CALL&&this._tuiCallEngine.getDevicePermission().video&&(i.video=!0),this._localStream=C.createStream(i),this._localStream.setVideoProfile(this._tuiCallEngine.getVideoQuality()),r.label=8;case 8:return r.trys.push([8,17,,18]),[4,this._localStream.initialize()];case 9:return r.sent(),this._tuiCallEngine.tim?[4,this._addAiNoiseReduce(this._tuiCallEngine.tim)]:[3,11];case 10:r.sent(),r.label=11;case 11:return o.default.log(T+".join - initialize local stream success"),this._localStream.on("player-state-changed",(function(e){o.default.log(T+".join - local stream "+e.type+" player is "+e.state)})),[4,this.publish()];case 12:return r.sent(),this._tuiCallEngine.isInviter()?[4,null==this?void 0:this.muteLocalVideo()]:[3,16];case 13:return r.sent(),[4,null==this?void 0:this.muteLocalAudio()];case 14:return r.sent(),this._displayLocalStream=C.createStream(i),this._displayLocalStream.setVideoProfile(this._tuiCallEngine.getVideoQuality()),[4,this._displayLocalStream.initialize()];case 15:r.sent(),this._isMuteAudioVideo=!0,r.label=16;case 16:return o.default.log(T+".publish success"),this._joinedTimestamp=new Date,[2,{audio:i.audio,video:i.video,userId:i.userId}];case 17:throw s=r.sent(),o.default.error(T+".join - failed to initialize local stream - "+s),new Error(T+".join - failed to initialize local stream - "+s);case 18:return[2]}}))}))},e.prototype._addAiNoiseReduce=function(e){return i(this,void 0,void 0,(function(){var t,n,i;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,6,,7]),[4,I.validateBusiness(e,f.CALL_EXPERMENTEL_API_TYPE.PRO)];case 1:return t=r.sent(),o.default.info(T+"._addAiNoiseReduce - aiNoiseReduceSupport."+t),t&&E?(this._assetsPath||o.default.warn(T+"._addAiNoiseReduce - please pass validate assetsPath"),this._aiNoiseSuppression=new E({assetsPath:this._assetsPath||g.AI_NOISE_REDUCE_ASSETS_PATH}),n=this,[4,this._aiNoiseSuppression.createProcessor({sdkAppId:this._sdkAppID,userId:this._userID,userSig:this._userSig})]):[3,5];case 2:return n._aiNoiseSuppressionProcessor=r.sent(),[4,this._aiNoiseSuppressionProcessor.process(this._localStream)];case 3:return r.sent(),[4,this.enableAIVoice(this._isAiNoiseSuppress)];case 4:r.sent(),r.label=5;case 5:return[3,7];case 6:return i=r.sent(),o.default.warn(T+"._addAiNoiseReduce - error."+i),[3,7];case 7:return[2]}}))}))},e.prototype.playLocalVideo=function(e){var t,n;return i(this,void 0,void 0,(function(){var i,s,a,l,u,c,d,h;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,13,,14]),o.default.debug(T+".playLocalVideo - params:",e),i=e.videoViewDomID,s=e.userID,a=e.options,l={userId:s,video:!0,audio:!1,screenAudio:!1},u=i,typeof i===v.NAME.STRING&&(u=document.getElementById(i)),this._tuiCallEngine.isInviter()?!this._displayLocalStream||this._displayLocalStream.hasVideo()?[3,5]:[4,(c=null==C?void 0:C.createStream(l)).setVideoProfile(this._tuiCallEngine.getVideoQuality())]:[3,7];case 1:return r.sent(),[4,c.initialize()];case 2:return r.sent(),d=c.getVideoTrack(),d?[4,this._displayLocalStream.addTrack(d)]:[3,4];case 3:r.sent(),r.label=4;case 4:r.label=5;case 5:return[4,null===(t=null==this?void 0:this._displayLocalStream)||void 0===t?void 0:t.play(u,a)];case 6:r.sent(),r.label=7;case 7:return!this._localStream||this._localStream.hasVideo()?[3,9]:(d=this._localStream.getVideoTrack(),[4,this.addTrack(d)]);case 8:r.sent(),r.label=9;case 9:return this._tuiCallEngine.isInviter()?[3,12]:u?[4,null===(n=null==this?void 0:this._localStream)||void 0===n?void 0:n.play(u,a)]:[3,11];case 10:r.sent(),r.label=11;case 11:r.label=12;case 12:return[3,14];case 13:throw h=r.sent(),o.default.error(T+".playLocalVideo - failed, error:"+h),new Error(T+".playLocalVideo - failed, error:"+h);case 14:return[2]}}))}))},e.prototype.stopLocalVideo=function(){return i(this,void 0,void 0,(function(){var e,t;return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,8,,9]),this._tuiCallEngine.isInviter()?[4,this.stopLocalPlayStreamTrack(v.NAME.VIDEO)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this._localStream?this._localStream.hasAudio()?(e=this._localStream.getVideoTrack())?[4,this._localStream.removeTrack(e)]:[3,4]:[3,5]:[3,7];case 3:n.sent(),e.stop(),n.label=4;case 4:return[3,7];case 5:return[4,this.unpublish()];case 6:n.sent(),this._localStream.stop(),this._localStream.close(),this._localStream=null,n.label=7;case 7:return[3,9];case 8:throw t=n.sent(),o.default.error(T+".stopLocalVideo - failed to play local video "+t),new Error(T+".stopLocalVideo - failed to play local video "+t);case 9:return[2]}}))}))},e.prototype.playRemoteVideo=function(e){return i(this,void 0,void 0,(function(){var t,n,i,s,a,l;return r(this,(function(r){switch(r.label){case 0:o.default.debug(T+".playRemoteVideo - params:",e),t=e.videoViewDomID,n=e.userID,i=e.options,s=t,typeof t===v.NAME.STRING&&(s=document.getElementById(t)),r.label=1;case 1:if(r.trys.push([1,3,,4]),!(a=this._remoteStreams.find((function(e){return e.getUserId()===n}))))throw new Error("currentRemoteUserStream is empty");if(!s)throw new Error("domID is empty");return[4,null==a?void 0:a.play(s,i)];case 2:return r.sent(),[3,4];case 3:throw l=r.sent(),o.default.error(T+".playRemoteVideo - failed to play remote video reason: "+l),new Error(T+".playRemoteVideo - failed to play remote video reason: "+l);case 4:return[2]}}))}))},e.prototype.stopRemoteVideo=function(e){return i(this,void 0,void 0,(function(){var t,n;return r(this,(function(i){o.default.debug(T+".stopRemoteVideo - params:",e),t=e.userID;try{(n=this._remoteStreams.find((function(e){return e.getUserId()===t})))&&n.hasVideo()&&n.getVideoTrack().stop()}catch(e){throw o.default.error(T+".stopRemoteVideo - failed to stop remote video "+e),new Error(T+".stopRemoteVideo - failed to stop remote video "+e)}return[2]}))}))},e.prototype.getCallType=function(){return this._tuiCallEngine.getCallType()},e.prototype.leave=function(){var e,t,n;return i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return o.default.log(T+"-leave._isJoined:"+this._isJoined),o.default.log(T+"-leave._localStream:"+this._localStream),this._isJoined?[4,this.unpublish()]:(o.default.warn(T+".leave - please join() firstly"),[2]);case 1:return r.sent(),this._tuiCallEngine.getCallDataReport().setExitRoomTime((new Date).getTime()),[4,this._client.leave()];case 2:return r.sent(),this._isJoined=!1,this._isPublished=!1,null===(e=null==this?void 0:this._localStream)||void 0===e||e.close(),null===(t=null==this?void 0:this._displayLocalStream)||void 0===t||t.close(),this._localStream=null,this._displayLocalStream=null,this._videoAvailableMap.clear(),this._isMuteAudioVideo=!1,this._leaveTimestamp=new Date,this._client.enableAudioVolumeEvaluation(-1),null===(n=null==this?void 0:this._aiNoiseSuppressionProcessor)||void 0===n||n.destroy(),this._aiNoiseSuppressionProcessor=null,this._isAiNoiseSuppress=!0,i=Math.floor((this._leaveTimestamp-this._joinedTimestamp)/1e3),new c.default(d.default.TALK_TIME).setTalkTime(i).setText("talkTime record").setEnd(),[2]}}))}))},e.prototype.publish=function(){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:if(!this._isJoined)return o.default.warn(T+".publish - please join() firstly"),[2];if(this._isPublished)return o.default.warn(T+".publish - duplicate RtcClient.publish() observed"),[2];if(this._tuiCallEngine.getCallStatus()===l.CALL_STATUS.IDLE)return o.default.warn(T+".join - early hangup"),this._tuiCallEngine.hangup(),[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._client.publish(this._localStream)];case 2:return t.sent(),o.default.log(T+".publish - success"),[3,4];case 3:return e=t.sent(),o.default.error(T+".publish - failed to publish local stream "+e),this._isPublished=!1,[3,4];case 4:return this._isPublished=!0,[2]}}))}))},e.prototype.unpublish=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return this._isPublished?this._localStream?this._unpublishing?(o.default.log(T+".unpublish - _unpublishing"),[2]):(this._unpublishing=!0,[4,this._client.unpublish(this._localStream)]):(o.default.warn(T+".unpublish - RtcClient._localStream is null"),[2]):(o.default.warn(T+".unpublish - RtcClient.unpublish() called but not published yet"),[2]);case 1:return e.sent(),o.default.log(T+".unpublish - complete"),this._unpublishing=!1,this._isPublished=!1,[2]}}))}))},e.prototype.playAudioStream=function(e){return i(this,void 0,void 0,(function(){var t,n,i,s;return r(this,(function(r){return t=e.getUserId(),n="_trtc_calling_audio_call-"+t,(i=document.getElementById("_trtc_calling_layer"))||((i=document.createElement("div")).setAttribute("id","_trtc_calling_layer"),i.style.display="none",document.body.appendChild(i)),(s=document.createElement("div")).setAttribute("id",n),i.appendChild(s),e&&(e.play(n),e.on("error",(function(t){if(16451===t.getCode()){var n=document.createElement("button");n.onclick=function(){o.default.log(T+".remoteStream - resume"),e.resume()},n.style.display="none",document.body.appendChild(n);var i=setTimeout((function(){n.click(),clearTimeout(i),document.body.removeChild(n)}),0)}}))),[2]}))}))},e.prototype.delegateVideoAvailableState=function(e,t){e&&this._videoAvailableMap.get(e)!==t&&(this._videoAvailableMap.set(e,t),this._tuiCallEngine._delegate.onUserVideoAvailable({userID:e,isVideoAvailable:t}))},e.prototype.querySubscribeSuccess=function(e){return void 0!==this._videoAvailableMap.get(e)},e.prototype.handleEvents=function(){var e=this;this._client.on("error",(function(t){o.default.error(T+".handleEvents - client on error "+t);var n=t.getCode(),i=JSON.stringify({name:v.NAME.TRTC,error:t});e._tuiCallEngine._delegate.onError(n,i)})),this._client.on("client-banned",(function(t){return i(e,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return o.default.error(T+".handleEvents - client has been banned for "+t),this._tuiCallEngine.getCallStatus()===l.CALL_STATUS.CONNECTED&&(e=this._tuiCallEngine.generateCallEndData(),this._tuiCallEngine._delegate.onCallEnd(e)),this._tuiCallEngine.getCallStatus()!==l.CALL_STATUS.CALLING?[3,2]:(this._tuiCallEngine._delegate.onCallingCancel(this._tuiCallEngine.getUserID()),[4,this._tuiCallEngine._cancel()]);case 1:n.sent(),n.label=2;case 2:return[4,this._tuiCallEngine._resetTUICallEngine()];case 3:return n.sent(),[2]}}))}))})),this._client.on("peer-join",(function(t){return i(e,void 0,void 0,(function(){var e,n,i;return r(this,(function(r){switch(r.label){case 0:return e=t.userId,this._localStream&&this._isPublished&&this._tuiCallEngine.isInviter()&&this._isMuteAudioVideo?[4,this.unMuteLocalVideo()]:[3,3];case 1:return r.sent(),[4,this.unMuteLocalAudio()];case 2:r.sent(),this._isMuteAudioVideo=!1,r.label=3;case 3:return o.default.log(T+".handleEvents - peer-join "+e),this._tuiCallEngine.getConnectStartTime()||(this._tuiCallEngine.setConnectStartTime(Date.now()),this._client.enableAudioVolumeEvaluation(1e3)),this._tuiCallEngine._delegate.onUserEnter(e),n=this._tuiCallEngine.isGroupCall(),this._tuiCallEngine.addHandledInviteeList([e]),this._tuiCallEngine.deleteUnHandledInviteeList([e]),this._tuiCallEngine.addAcceptedUserList(null,[e]),this._tuiCallEngine.changeCallStatus(l.CALL_STATUS.CONNECTED),n&&(i=this._tuiCallEngine.getHandledInviteeList(),this._tuiCallEngine._delegate.onGroupCallInviteeListUpdate(i)),[2]}}))}))})),this._client.on("peer-leave",(function(t){return i(e,void 0,void 0,(function(){var e,n,i,s,a,u,c,d;return r(this,(function(r){switch(r.label){case 0:return this._tuiCallEngine.getCallStatus()===l.CALL_STATUS.IDLE?[2]:(e=t.userId,o.default.log(T+".handleEvents - peer-leave:"+e),n=this._tuiCallEngine.isGroupCall(),this._tuiCallEngine.deleteHandledInviteeList([e]),this._videoAvailableMap.delete(e),this._tuiCallEngine._delegate.onUserLeave(e),n?(i=this._tuiCallEngine.getHandledInviteeList(),s=this._tuiCallEngine.getUnHandledInviteeList(),0!==i.length&&this._tuiCallEngine._delegate.onGroupCallInviteeListUpdate(i),a=this._tuiCallEngine.getUserID(),1!==i.length||i[0]!==a||0!==s.length?[3,2]:(u=this._tuiCallEngine.generateCallEndData(),this._tuiCallEngine._delegate.onCallEnd(u),[4,this._tuiCallEngine._resetTUICallEngine()])):[3,3]);case 1:r.sent(),r.label=2;case 2:return[3,6];case 3:return c=this._tuiCallEngine.getHandledInviteeList(),d={callType:this._tuiCallEngine.getCallType(),userIDList:[e],callEnd:Math.round((Date.now()-this._tuiCallEngine.getConnectStartTime())/1e3)},1!==c.length?[3,6]:[4,this._tuiCallEngine._tsignalingClient.hangup(d)];case 4:return r.sent(),[4,this._tuiCallEngine._resetTUICallEngine()];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))})),this._client.on("stream-added",(function(t){return i(e,void 0,void 0,(function(){var e,n,i,s,a,l;return r(this,(function(r){switch(r.label){case 0:e=t.stream,n=e.getId(),i=e.getUserId(),o.default.log(T+".handleEvents - remote stream added, userID:"+i+" streamID:"+n+" type:"+e.getType()),r.label=1;case 1:return r.trys.push([1,3,,5]),[4,this._client.subscribe(e)];case 2:return r.sent(),[3,5];case 3:return s=r.sent(),a=s.getCode(),l=JSON.stringify({name:"TRTC",error:s}),[4,this._tuiCallEngine._resetTUICallEngine()];case 4:return r.sent(),this._tuiCallEngine._delegate.onError(a,l),[3,5];case 5:return[2]}}))}))})),this._client.on("stream-subscribed",(function(t){return i(e,void 0,void 0,(function(){var e,n;return r(this,(function(i){return e=t.stream,n=e.getUserId(),o.default.log(T+".handleEvents - stream subscribed, _remoteStreams:"+this._remoteStreams+", userID:"+n),this._remoteStreams.push(e),this.delegateVideoAvailableState(n,!0),this.getCallType()===l.CALL_TYPE.AUDIO_CALL&&this.playAudioStream(e),[2]}))}))})),this._client.on("stream-removed",(function(t){var n=t.stream,i=n.getId(),r=n.getUserId(),s="_trtc_calling_audio_call-"+r;if(o.default.log(T+".handleEvents - remote stream-removed, streamID:"+i+" type:"+n.getType()),n.stop(),n.close(),e._remoteStreams=e._remoteStreams.filter((function(e){return e.getId()!==i})),e.getCallType()===l.CALL_TYPE.AUDIO_CALL){var a=document.getElementById("_trtc_calling_layer"),u=document.getElementById(s);a&&u&&a.removeChild(u)}e._videoAvailableMap.delete(r)})),this._client.on("stream-updated",(function(t){var n=t.stream,i=n.getUserId(),r=n.getType(),s=n.hasAudio(),a=n.hasVideo();o.default.log(T+".handleEvents - stream-updated, type:"+r+" hasAudio:"+s+" hasVideo:"+a),e.querySubscribeSuccess(i)&&e.delegateVideoAvailableState(i,!!a)})),this._client.on("mute-audio",(function(t){o.default.debug(T+".handleEvents - "+t.userId+" mute audio"),e._tuiCallEngine._delegate.onUserAudioAvailable({userID:t.userId,isAudioAvailable:!1})})),this._client.on("unmute-audio",(function(t){o.default.debug(T+".handleEvents - "+t.userId+" unmute audio"),e._tuiCallEngine._delegate.onUserAudioAvailable({userID:t.userId,isAudioAvailable:!0})})),this._client.on("mute-video",(function(t){o.default.debug(T+".handleEvents - "+t.userId+" mute video"),e.querySubscribeSuccess(t.userId)&&e.delegateVideoAvailableState(t.userId,!1)})),this._client.on("unmute-video",(function(t){o.default.debug(T+".handleEvents - "+t.userId+" unmute video"),e.querySubscribeSuccess(t.userId)&&e.delegateVideoAvailableState(t.userId,!0)})),this._client.on("audio-volume",(function(t){o.default.debug(T+".handleEvents - "+t+" audio volume"),e._tuiCallEngine._delegate.onUserVoiceVolume(t.result)})),this._client.on("connection-state-changed",(function(e){o.default.log(T+".handleEvents - RtcClient state changed from "+e.prevState+" to "+e.state)}))},e.prototype.muteLocalVideo=function(){var e;return i(this,void 0,void 0,(function(){return r(this,(function(t){return[2,null===(e=this._localStream)||void 0===e?void 0:e.muteVideo()]}))}))},e.prototype.unMuteLocalVideo=function(){var e;return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:if(t=this._localStream.getVideoTrack())return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.addTrack(t)];case 2:return n.sent(),[2,!0];case 3:return n.sent(),o.default.warn(T+".unMuteLocalVideo - add video track failed"),[3,4];case 4:return[3,6];case 5:return[2,null===(e=this._localStream)||void 0===e?void 0:e.unmuteVideo()];case 6:return[2]}}))}))},e.prototype.muteLocalAudio=function(){var e,t;return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,null===(e=this._displayLocalStream)||void 0===e?void 0:e.muteAudio()];case 1:return n.sent(),[4,null===(t=this._localStream)||void 0===t?void 0:t.muteAudio()];case 2:return n.sent(),[2]}}))}))},e.prototype.unMuteLocalAudio=function(){var e,t;return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,null===(e=this._displayLocalStream)||void 0===e?void 0:e.unmuteAudio()];case 1:return n.sent(),[4,null===(t=this._localStream)||void 0===t?void 0:t.unmuteAudio()];case 2:return n.sent(),[2]}}))}))},e.prototype.switchCallMode=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:switch(o.default.log(T+".switchCallMode - type",e),t=this._localStream.getVideoTrack(),e){case l.CALL_TYPE.VIDEO_CALL:return[3,1];case l.CALL_TYPE.AUDIO_CALL:return[3,5]}return[3,9];case 1:return n.trys.push([1,3,,4]),[4,this.stopLocalPlayStreamTrack(v.NAME.VIDEO)];case 2:return n.sent(),this.removeTrack(t),this._tuiCallEngine.setCallType(l.CALL_TYPE.AUDIO_CALL),this._tuiCallEngine.setSwitchCallModeStatus(!0),this._tuiCallEngine._delegate.onCallTypeChanged(l.CALL_TYPE.VIDEO_CALL,l.CALL_TYPE.AUDIO_CALL),[3,4];case 3:return n.sent(),this._tuiCallEngine._delegate.onError(p.default.FAILURE_SWITCH_TO_AUDIO,_.default.FAILURE_SWITCH_TO_AUDIO),[3,4];case 4:return[3,9];case 5:return n.trys.push([5,7,,8]),[4,this.addTrack(t)];case 6:return n.sent(),this._tuiCallEngine.setCallType(l.CALL_TYPE.VIDEO_CALL),this._tuiCallEngine.setSwitchCallModeStatus(!0),this._tuiCallEngine._delegate.onCallTypeChanged(l.CALL_TYPE.AUDIO_CALL,l.CALL_TYPE.VIDEO_CALL),[3,8];case 7:return n.sent(),this._tuiCallEngine._delegate.onError(p.default.FAILURE_SWITCH_TO_VIDEO,_.default.FAILURE_SWITCH_TO_VIDEO),[3,8];case 8:return[3,9];case 9:return[2]}}))}))},e.prototype.removeTrack=function(e){return i(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:if(o.default.log(T+".removeTrack ",!!e),!e)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._localStream.removeTrack(e)];case 2:return n.sent(),e.stop(),[3,4];case 3:throw t=n.sent(),o.default.error(T+".removeTrack - failed to removeTrack local stream "+t),new Error(t);case 4:return[2]}}))}))},e.prototype.addTrack=function(e){var t;return i(this,void 0,void 0,(function(){var n,i,s;return r(this,(function(r){switch(r.label){case 0:return o.default.log(T+".addTrack ",!e),e?[3,7]:[4,(n=C.createStream({userId:this._tuiCallEngine.getUserID(),audio:!1,video:!0})).setVideoProfile(this._tuiCallEngine.getVideoQuality())];case 1:return r.sent(),[4,n.initialize()];case 2:r.sent(),i=n.getVideoTrack(),r.label=3;case 3:return r.trys.push([3,6,,7]),i?[4,null===(t=this._localStream)||void 0===t?void 0:t.addTrack(i)]:[3,5];case 4:r.sent(),r.label=5;case 5:return[3,7];case 6:throw s=r.sent(),o.default.error(T+".addTrack - failed to addTrack local stream "+s),new Error(s);case 7:return[2]}}))}))},e.prototype.reset=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return this._isJoined?[4,this.leave()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.getMediaDevicesAuth=function(e){return i(this,void 0,void 0,(function(){var t,n,i;return r(this,(function(r){switch(r.label){case 0:if(!e.audio)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({audio:!0,video:!1})];case 2:return n=r.sent(),this.releaseStream(n),this._tuiCallEngine.setDevicePermission(l.DEVICE_TYPE.AUDIO,!0),[3,4];case 3:throw t=r.sent(),this._tuiCallEngine.setDevicePermission(l.DEVICE_TYPE.AUDIO,!1),new Error(t);case 4:if(!e.video)return[3,8];r.label=5;case 5:return r.trys.push([5,7,,8]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 6:return n=r.sent(),this.releaseStream(n),this._tuiCallEngine.setDevicePermission(l.DEVICE_TYPE.VIDEO,!0),[3,8];case 7:if(i=r.sent(),this._tuiCallEngine.setDevicePermission(l.DEVICE_TYPE.VIDEO,!1),o.default.error(T+".getMediaDevicesAuth - failed to get user video steam - "+i),e.isThrowVideoError)throw new Error(i);return[3,8];case 8:return[2,this._tuiCallEngine.getDevicePermission()]}}))}))},e.prototype.enableAIVoice=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return this._isAiNoiseSuppress=e,this._aiNoiseSuppressionProcessor?(o.default.info(T+".enableAIVoice "+e),e?[4,this._aiNoiseSuppressionProcessor.enable()]:[3,2]):[2];case 1:return t.sent(),[3,4];case 2:return[4,this._aiNoiseSuppressionProcessor.disable()];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))},e.prototype.releaseStream=function(e){for(var t=e.getTracks(),n=0;n<t.length;n++)t[n].stop()},e.prototype.stopLocalPlayStreamTrack=function(e){return i(this,void 0,void 0,(function(){var t,n;return r(this,(function(i){switch(i.label){case 0:return this._displayLocalStream?e!==v.NAME.VIDEO?[3,4]:this._displayLocalStream.hasAudio()?(t=this._displayLocalStream.getVideoTrack())?[4,this._displayLocalStream.removeTrack(t)]:[3,2]:[3,3]:[3,5];case 1:i.sent(),t.stop(),i.label=2;case 2:return[3,4];case 3:this._displayLocalStream.stop(),this._displayLocalStream.close(),this._displayLocalStream=null,i.label=4;case 4:e===v.NAME.AUDIO&&(this._displayLocalStream.hasVideo()?(n=this._displayLocalStream.getAudioTrack())&&(this.muteLocalAudio(),n.stop()):(this._displayLocalStream.stop(),this._displayLocalStream.close(),this._displayLocalStream=null)),i.label=5;case 5:return[2]}}))}))},e}();t.default=m},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var i=n(2),r=n(17),s=n(35),a=n(23);function o(e){var t=new s(e),n=r(s.prototype.request,t);return i.extend(n,s.prototype,t),i.extend(n,t),n}var l=o(n(13));l.Axios=s,l.create=function(e){return o(a(l.defaults,e))},l.Cancel=n(24),l.CancelToken=n(50),l.isCancel=n(22),l.all=function(e){return Promise.all(e)},l.spread=n(51),l.isAxiosError=n(52),e.exports=l,e.exports.default=l},function(e,t,n){"use strict";var i=n(2),r=n(18),s=n(36),a=n(37),o=n(23),l=n(48),u=l.validators;function c(e){this.defaults=e,this.interceptors={request:new s,response:new s}}c.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=o(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&l.assertOptions(t,{silentJSONParsing:u.transitional(u.boolean,"1.0.0"),forcedJSONParsing:u.transitional(u.boolean,"1.0.0"),clarifyTimeoutError:u.transitional(u.boolean,"1.0.0")},!1);var n=[],i=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(i=i&&t.synchronous,n.unshift(t.fulfilled,t.rejected))}));var r,s=[];if(this.interceptors.response.forEach((function(e){s.push(e.fulfilled,e.rejected)})),!i){var c=[a,void 0];for(Array.prototype.unshift.apply(c,n),c=c.concat(s),r=Promise.resolve(e);c.length;)r=r.then(c.shift(),c.shift());return r}for(var d=e;n.length;){var h=n.shift(),p=n.shift();try{d=h(d)}catch(e){p(e);break}}try{r=a(d)}catch(e){return Promise.reject(e)}for(;s.length;)r=r.then(s.shift(),s.shift());return r},c.prototype.getUri=function(e){return e=o(this.defaults,e),r(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},i.forEach(["delete","get","head","options"],(function(e){c.prototype[e]=function(t,n){return this.request(o(n||{},{method:e,url:t,data:(n||{}).data}))}})),i.forEach(["post","put","patch"],(function(e){c.prototype[e]=function(t,n,i){return this.request(o(i||{},{method:e,url:t,data:n}))}})),e.exports=c},function(e,t,n){"use strict";var i=n(2);function r(){this.handlers=[]}r.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){i.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=r},function(e,t,n){"use strict";var i=n(2),r=n(38),s=n(22),a=n(13);function o(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return o(e),e.headers=e.headers||{},e.data=r.call(e,e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),i.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return o(e),t.data=r.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return s(t)||(o(e),t&&t.response&&(t.response.data=r.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,n){"use strict";var i=n(2),r=n(13);e.exports=function(e,t,n){var s=this||r;return i.forEach(n,(function(n){e=n.call(s,e,t)})),e}},function(e,t){var n,i,r=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var l,u=[],c=!1,d=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&p())}function p(){if(!c){var e=o(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function _(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new _(e,t)),1!==u.length||c||o(p)},_.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";var i=n(2);e.exports=function(e,t){i.forEach(e,(function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])}))}},function(e,t,n){"use strict";var i=n(21);e.exports=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(i("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},function(e,t,n){"use strict";var i=n(2);e.exports=i.isStandardBrowserEnv()?{write:function(e,t,n,r,s,a){var o=[];o.push(e+"="+encodeURIComponent(t)),i.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),i.isString(r)&&o.push("path="+r),i.isString(s)&&o.push("domain="+s),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,n){"use strict";var i=n(44),r=n(45);e.exports=function(e,t){return e&&!i(t)?r(e,t):t}},function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";var i=n(2),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,s,a={};return e?(i.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=i.trim(e.substr(0,s)).toLowerCase(),n=i.trim(e.substr(s+1)),t){if(a[t]&&r.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}})),a):a}},function(e,t,n){"use strict";var i=n(2);e.exports=i.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var i=e;return t&&(n.setAttribute("href",i),i=n.href),n.setAttribute("href",i),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=i.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},function(e,t,n){"use strict";var i=n(49),r={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){r[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var s={},a=i.version.split(".");function o(e,t){for(var n=t?t.split("."):a,i=e.split("."),r=0;r<3;r++){if(n[r]>i[r])return!0;if(n[r]<i[r])return!1}return!1}r.transitional=function(e,t,n){var r=t&&o(t);function a(e,t){return"[Axios v"+i.version+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,o){if(!1===e)throw new Error(a(i," has been removed in "+t));return r&&!s[i]&&(s[i]=!0,console.warn(a(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}},e.exports={isOlderVersion:o,assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var i=Object.keys(e),r=i.length;r-- >0;){var s=i[r],a=t[s];if(a){var o=e[s],l=void 0===o||a(o,s,e);if(!0!==l)throw new TypeError("option "+s+" must be "+l)}else if(!0!==n)throw Error("Unknown option "+s)}},validators:r}},function(e){e.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')},function(e,t,n){"use strict";var i=n(24);function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new i(e),t(n.reason))}))}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var e;return{token:new r((function(t){e=t})),cancel:e}},e.exports=r},function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){"use strict";e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,i,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},a=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var s=arguments[t],a=0,o=s.length;a<o;a++,r++)i[r]=s[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var l=n(56),u=n(0),c=n(6),d="TSignalClient",h=n(10),p=function(){function e(e,t){this._tuiCallEngine=e,this._tsignaling=new l(t),this._tsignalingReady=!1,this._joined=!1,this._newInvitationData=null,this._resolveMap=new Map,this.initEvents()}return e.prototype.setTSignalingIsJoined=function(e){this._joined=e},e.prototype.getTSignalingIsJoined=function(){return this._joined},e.prototype.setLogLevel=function(e){this._tsignaling.setLogLevel(e)},e.prototype.initEvents=function(){var e=this._tsignaling;e.on(l.EVENT.SDK_READY,this.onSdkReady,this),e.on(l.EVENT.SDK_NOT_READY,this.onSdkNotReady,this),e.on(l.EVENT.NEW_INVITATION_RECEIVED,this.onNewInvitationReceived,this),e.on(l.EVENT.INVITEE_ACCEPTED,this.onInviteeAccepted,this),e.on(l.EVENT.INVITEE_REJECTED,this.onInviteeRejected,this),e.on(l.EVENT.INVITATION_CANCELLED,this.onInvitationCancelled,this),e.on(l.EVENT.INVITATION_TIMEOUT,this.onInvitationTimeout,this),e.on(l.EVENT.KICKED_OUT,this.onKickedOut,this),e.on(l.EVENT.NET_STATE_CHANGE,this.onNetStateChange,this),l.EVENT.MESSAGE_SENT_BY_ME&&e.on(l.EVENT.MESSAGE_SENT_BY_ME,this.onMessageSentByMe,this)},e.prototype.onSdkReady=function(e){this._tsignalingReady=!0,this._tuiCallEngine._delegate.onSdkReady(e);var t=this._resolveMap.get("login");t&&(t.resolve(t.value),this._resolveMap.delete("login"))},e.prototype.onSdkNotReady=function(){this._tsignalingReady=!1},e.prototype.onNewInvitationReceived=function(e){var t,n;return r(this,void 0,void 0,(function(){var i,r,a,o,l,h,p,_,f,E;return s(this,(function(s){switch(s.label){case 0:return i=this._tuiCallEngine.getCallStatus(),u.default.log(d+".onNewInvitationReceived - params:",e,"currentCallStatus:"+i),r=e.data,a=r.inviter,o=r.inviteeList,l=r.data,h=r.inviteID,p=r.groupID,(_=JSON.parse(l)).room_id||(_.room_id=null===(t=null==_?void 0:_.data)||void 0===t?void 0:t.room_id),this._tuiCallEngine.getUserID()===a?[2]:(E={inviter:a,inviteeList:o,inviteID:h,isGroupCall:f=!!p,inviteData:_,groupID:p,currentCallStatus:i,inCallUserIDs:(null==_?void 0:_.inCallUserIDs)||[]},(null===(n=null==_?void 0:_.data)||void 0===n?void 0:n.cmd)!==c.CMD_TYPE.HANG_UP?[3,2]:(u.default.log(d+".hangup - params:",a,_,this._tuiCallEngine.getHandledInviteeList(),this._tuiCallEngine.getUnHandledInviteeList(),i,f),i===c.CALL_STATUS.IDLE?[2]:[4,this.handleHangupSignal(E)]));case 1:return s.sent(),[2];case 2:return!p&&this.judgeSwitchCallMode(_)?(i!==c.CALL_STATUS.IDLE&&this._tuiCallEngine.getRoomID()===_.room_id&&(this.handleSwitchCallMode(h,_),this._tuiCallEngine.addAudioVideoSwitchIdList(h)),[2]):i!==c.CALL_STATUS.IDLE?(this.reject({inviteID:h,callType:_.call_type,isBusy:!0}),[2]):(this.handleInvitedSignal(E),[2])}}))}))},e.prototype.handleHangupSignal=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,o,l,u,d;return s(this,(function(s){switch(s.label){case 0:if(t=e.inviter,n=e.inviteData,i=e.currentCallStatus,r=e.inviteeList,a=this._tuiCallEngine.isGroupCall(),o=this._tuiCallEngine.isInviter(),i===c.CALL_STATUS.CALLING){if(u=this._tuiCallEngine.getHandledInviteeList(),-1!==(d=this._tuiCallEngine.getUnHandledInviteeList()).indexOf(t)&&this._tuiCallEngine.deleteUnHandledInviteeList([t]),-1===u.indexOf(t))return[2]}else if(this._tuiCallEngine.deleteHandledInviteeList([t]),-1===(u=this._tuiCallEngine.getHandledInviteeList()).indexOf(t)&&u.length>1)return[2];return l=this._tuiCallEngine.generateCallEndData({totalTime:n.call_end||0}),a?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()];case 1:return s.sent(),this._tuiCallEngine._delegate.onCallEnd(l),[3,10];case 2:return this._tuiCallEngine.deleteHandledInviteeList([t]),u=this._tuiCallEngine.getHandledInviteeList(),d=this._tuiCallEngine.getUnHandledInviteeList(),o?1!==u.length||0!==d.length?[3,4]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,5];case 3:s.sent(),this._tuiCallEngine._delegate.onCallEnd(l),s.label=4;case 4:return[3,10];case 5:return i!==c.CALL_STATUS.CALLING?[3,8]:(-1!==r.indexOf(this._tuiCallEngine.getUserID())&&this._tuiCallEngine._delegate.onUserLeave(t),0!==u.length||1!==d.length?[3,7]:[4,this._tuiCallEngine._resetTUICallEngine()]);case 6:s.sent(),this._tuiCallEngine._delegate.onCallingCancel(t),s.label=7;case 7:return[3,10];case 8:return 1!==u.length||0!==d.length?[3,10]:[4,this._tuiCallEngine._resetTUICallEngine()];case 9:s.sent(),this._tuiCallEngine._delegate.onCallEnd(l),s.label=10;case 10:return[2]}}))}))},e.prototype.handleInvitedSignal=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,l,u,d,p,_,f;return s(this,(function(s){return t=e.inviter,n=e.inviteeList,r=e.isGroupCall,a=e.groupID,l=e.inviteID,u=e.inviteData,d=e.inCallUserIDs,p=void 0===d?[]:d,this._tuiCallEngine.changeCallStatus(c.CALL_STATUS.CALLING),this._tuiCallEngine.setInviterID(t),this._tuiCallEngine.setInviteeList(n),this._tuiCallEngine.setRoomID(u.room_id),this._tuiCallEngine.addUnHandledInviteeList(o(n,p)),this._tuiCallEngine.addHandledInviteeList([t]),this._tuiCallEngine.addAcceptedUserList(l,[t]),r&&(this._tuiCallEngine.setIsGroupCall(r),this._tuiCallEngine.setGroupID(a)),this._tuiCallEngine.addInviterInviteId(l,o([t],n)),_=p.filter((function(e){return-1===n.indexOf(e)})),this._newInvitationData={sponsor:t,userIDList:o(n,_),isFromGroup:r,inviteID:l,groupID:a,inviteData:{version:u.version,callType:u.call_type,roomID:u.room_id}},f=this._tuiCallEngine.getCallDataReport().getCallData(),f=i(i({},f),{roomID:u.room_id,inviteID:l,callRole:c.CALL_ROLE.INVITEE,callType:u.call_type,inviteeList:n,callScene:a?h.NAME.GROUP_CALL:h.NAME.SINGLE_CALL}),this._tuiCallEngine.getCallDataReport().setCallData(f),this._tuiCallEngine._delegate.onInvited(this._newInvitationData),[2]}))}))},e.prototype.getInviteData=function(){return this._newInvitationData},e.prototype.setInviteData=function(e){this._newInvitationData=e},e.prototype.handleSwitchCallMode=function(e,t){var n={inviteID:e,callType:t.call_type,switch_to_audio_call:null},i={cmd:c.CMD_TYPE.SWITCH_TO_VIDEO};t.call_type===c.CALL_TYPE.VIDEO_CALL?(n.switch_to_audio_call=c.CMD_TYPE.SWITCH_TO_AUDIO_CALL,i.cmd=c.CMD_TYPE.SWITCH_TO_AUDIO):delete n.switch_to_audio_call;var r=this._tuiCallEngine.getCallStatus();if(this.accept(n,i),r===c.CALL_STATUS.CALLING){var s=t.call_type===c.CALL_TYPE.VIDEO_CALL?c.CALL_TYPE.AUDIO_CALL:c.CALL_TYPE.VIDEO_CALL;this._tuiCallEngine._delegate.onCallTypeChanged(t.call_type,s),this._newInvitationData.inviteData.callType=s,this._tuiCallEngine.setSwitchCallModeStatus(!1)}else r===c.CALL_STATUS.CONNECTED&&(this._tuiCallEngine.setSwitchCallModeStatus(!1),this._tuiCallEngine._trtcClient.switchCallMode(this._tuiCallEngine.getCallType()))},e.prototype.judgeSwitchCallMode=function(e){var t=e.switch_to_audio_call&&e.switch_to_audio_call===c.CMD_TYPE.SWITCH_TO_AUDIO_CALL||e.data&&e.data.cmd===c.CMD_TYPE.SWITCH_TO_AUDIO||e.data&&e.data.cmd===c.CMD_TYPE.SWITCH_TO_VIDEO;return u.default.log(d+".switchCallMode:",e,"isSwitchCallMode-"+t),t},e.prototype.onInviteeAccepted=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return s(this,(function(s){switch(s.label){case 0:return u.default.log(d+".onInviteeAccepted - params:",e),t=JSON.parse(e.data.data),n=e.data.invitee,i=e.data.inviteID,-1===this._tuiCallEngine.getTotalInviterInviteIdList().indexOf(i)?[2]:this._tuiCallEngine.isGroupCall()||!this.judgeSwitchCallMode(t)||this._tuiCallEngine.getSwitchCallModeStatus()?(r=this._tuiCallEngine.getCallStatus(),n!==this._tuiCallEngine.getUserID()||r!==c.CALL_STATUS.CALLING?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()]):(this._tuiCallEngine._trtcClient.switchCallMode(this._tuiCallEngine.getCallType()),[2]);case 1:return s.sent(),this._tuiCallEngine._delegate.onCallingCancel(n),[2];case 2:return this._tuiCallEngine.isInviter()&&this._tuiCallEngine.changeCallStatus(c.CALL_STATUS.CONNECTED),this._tuiCallEngine._delegate.onUserAccept(n),this._tuiCallEngine.addHandledInviteeList([n]),this._tuiCallEngine.deleteUnHandledInviteeList([n]),this._tuiCallEngine.addAcceptedUserList(i,[n]),[2]}}))}))},e.prototype.onInviteeRejected=function(e){var t;return r(this,void 0,void 0,(function(){var n,i,r,a,o,l,h,p,_,f,E;return s(this,(function(s){switch(s.label){case 0:return u.default.log(d+".onInviteeRejected - params:",e),n=e.data.inviteID,this._tuiCallEngine.isGroupCall()||this._tuiCallEngine.getSwitchCallModeStatus()||-1===this._tuiCallEngine.getAudioVideoSwitchIdList().indexOf(n)?(i=e.data.invitee,r=e.data.inviter,a=this._tuiCallEngine.getUserID(),o=this._tuiCallEngine.getCallStatus(),l=JSON.parse(e.data.data),o===c.CALL_STATUS.IDLE?[2]:-1===this._tuiCallEngine.getInviterInviteIdList().indexOf(n)?(this._tuiCallEngine.deleteUnHandledInviteeList([i]),[2]):a!==i||o!==c.CALL_STATUS.CALLING?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()]):(u.default.log(d+".onInviteeRejected - Audio and video switching is not available"),this._tuiCallEngine.setSwitchCallModeStatus(!0),[2]);case 1:return s.sent(),this._tuiCallEngine._delegate.onCallingCancel(i),[2];case 2:return h=this._tuiCallEngine.isGroupCall(),p=this._tuiCallEngine.isInviter(),this._tuiCallEngine.deleteUnHandledInviteeList([i]),_=this._tuiCallEngine.getUnHandledInviteeList(),f=this._tuiCallEngine.getHandledInviteeList(),o===c.CALL_STATUS.CONNECTED&&-1!==f.indexOf(i)?[2]:"line_busy"===l.line_busy||""===l.line_busy||(null===(t=null==l?void 0:l.data)||void 0===t?void 0:t.message)&&"lineBusy"===l.data.message?h?[3,4]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,7];case 3:return s.sent(),this._tuiCallEngine._delegate.onCallingCancel(i),[3,6];case 4:return 0!==_.length||1!==f.length?[3,6]:[4,this._tuiCallEngine._resetTUICallEngine()];case 5:s.sent(),this._tuiCallEngine._delegate.onCallingCancel(i),s.label=6;case 6:return r===this._tuiCallEngine.getInviterID()&&this._tuiCallEngine._delegate.onLineBusy(i),[3,18];case 7:return h?[3,9]:[4,this._tuiCallEngine._resetTUICallEngine()];case 8:return s.sent(),this._tuiCallEngine._delegate.onCallingCancel(i),this._tuiCallEngine._delegate.onReject(i),[3,18];case 9:return o!==c.CALL_STATUS.CALLING?[3,15]:p?0!==_.length||1!==f.length?[3,11]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,12];case 10:s.sent(),this._tuiCallEngine._delegate.onCallingCancel(i),s.label=11;case 11:return[3,14];case 12:return 1!==_.length||0!==f.length?[3,14]:[4,this._tuiCallEngine._resetTUICallEngine()];case 13:s.sent(),this._tuiCallEngine._delegate.onCallingCancel(i),s.label=14;case 14:return[3,17];case 15:return 0!==_.length||1!==f.length?[3,17]:(E=this._tuiCallEngine.generateCallEndData({userId:i}),[4,this._tuiCallEngine._resetTUICallEngine()]);case 16:s.sent(),this._tuiCallEngine._delegate.onCallEnd(E),s.label=17;case 17:this._tuiCallEngine._delegate.onReject(i),s.label=18;case 18:return[2]}}))}))},e.prototype.onInvitationCancelled=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return u.default.log(d+".onInvitationCancelled - params:",e),-1===this._tuiCallEngine.getInviterInviteIdList().indexOf(e.data.inviteID)||this._tuiCallEngine.getCallStatus()===c.CALL_STATUS.CONNECTED?[2]:[4,this._tuiCallEngine._resetTUICallEngine()];case 1:return t.sent(),this._tuiCallEngine._delegate.onCallingCancel(this._tuiCallEngine.getUserID()),[2]}}))}))},e.prototype.onInvitationTimeout=function(e){var t;return r(this,void 0,void 0,(function(){var n,i,r,a,o,l,h,p,_,f,E,I;return s(this,(function(s){switch(s.label){case 0:return n=e.data,i=n.inviter,r=n.inviteeList,a=void 0===r?[]:r,o=n.inviteID,l=this._tuiCallEngine.getUserID(),h=this._tuiCallEngine.isGroupCall(),p=this._tuiCallEngine.isInviter(),_=this._tuiCallEngine.getCallStatus(),this._tuiCallEngine.deleteUnHandledInviteeList(a),u.default.log(d+".onInvitationTimeout - params:",e,"currentUserID:"+l+" isInviter:"+p+" isGroupCall:"+h+" currentCallStatus:"+_+" inviteID:"+(null===(t=null==this?void 0:this._newInvitationData)||void 0===t?void 0:t.inviteID)),-1===this._tuiCallEngine.getInviterInviteIdList().indexOf(o)?[2]:_===c.CALL_STATUS.IDLE?[2]:(f=this._tuiCallEngine.getHandledInviteeList(),E=this._tuiCallEngine.getUnHandledInviteeList(),h?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()]);case 1:return s.sent(),p?(this._tuiCallEngine._delegate.onCallingCancel(a[0]),this._tuiCallEngine._delegate.onNoResp(i,a)):this._tuiCallEngine._delegate.onCallingCancel(a[0]||""),[3,11];case 2:return _!==c.CALL_STATUS.CALLING?[3,9]:p?0!==E.length?[3,4]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,5];case 3:s.sent(),this._tuiCallEngine._delegate.onCallingCancel(a.join(",")),s.label=4;case 4:return this._tuiCallEngine._delegate.onNoResp(i,a),[3,8];case 5:return-1!==a.indexOf(l)?[3,6]:(this._tuiCallEngine._delegate.onNoResp(i,a),[3,8]);case 6:return[4,this._tuiCallEngine._resetTUICallEngine()];case 7:s.sent(),this._tuiCallEngine._delegate.onCallingCancel(l),s.label=8;case 8:return[3,11];case 9:return this._tuiCallEngine._delegate.onNoResp(i,a),1!==f.length||0!==E.length?[3,11]:(I=this._tuiCallEngine.generateCallEndData(),[4,this._tuiCallEngine._resetTUICallEngine()]);case 10:s.sent(),this._tuiCallEngine._delegate.onCallEnd(I),s.label=11;case 11:return[2]}}))}))},e.prototype.onKickedOut=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return u.default.log(d+".onKickedOut"),[4,this._tuiCallEngine._resetTUICallEngine()];case 1:return e.sent(),this._tuiCallEngine._delegate.onKickedOut(),[2]}}))}))},e.prototype.onNetStateChange=function(){u.default.debug(d+".onNetStateChange")},e.prototype.onMessageSentByMe=function(e){this._tuiCallEngine._delegate.onMessageSentByMe(e)},e.prototype.login=function(e){return r(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){return[2,new Promise((function(n,i){t._tsignaling.login(e).then((function(e){t._resolveMap.set("login",{resolve:n,value:e})})).catch((function(e){i(e)}))}))]}))}))},e.prototype.logout=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){return this._joined=!1,[2,this._tsignaling.logout()]}))}))},e.prototype.invite=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,o,l,u;return s(this,(function(s){switch(s.label){case 0:return t=e.userID,n=e.type,r=e.roomID,a=e.timeout,o=e.offlinePushInfo,l=e.userIDList,[4,this._tsignaling.invite({userID:t,data:JSON.stringify(this.handleNewSignaling({version:0,call_type:n,room_id:r},{userIDs:l})),timeout:a,offlinePushInfo:o})];case 1:return u=s.sent(),[2,i(i({},u),{roomID:r,userID:t})]}}))}))},e.prototype.inviteInGroup=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,o,l,u,c;return s(this,(function(s){switch(s.label){case 0:return t=e.groupID,n=e.userIDList,r=e.roomID,a=e.type,o=e.timeout,l=e.offlinePushInfo,u=e.inCallUserIDs,[4,this._tsignaling.inviteInGroup({groupID:t,inviteeList:n,data:JSON.stringify(this.handleNewSignaling({version:0,call_type:a,room_id:r,inCallUserIDs:u})),timeout:o,offlinePushInfo:l})];case 1:return c=s.sent(),[2,i(i({},c),{roomID:r,groupID:t})]}}))}))},e.prototype.hangup=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,o,l,h;return s(this,(function(s){switch(s.label){case 0:return u.default.log(d+".hangup - params:",e),t=e.userIDList,n=e.callType,i=e.callEnd,a={version:0,call_type:n,call_end:r=void 0===i?0:i},o={cmd:c.CMD_TYPE.HANG_UP},l=JSON.stringify(this.handleNewSignaling(a,o)),this._tuiCallEngine.isGroupCall()&&this._tuiCallEngine.getGroupID()?[4,this._tsignaling.inviteInGroup({inviteeList:t,groupID:this._tuiCallEngine.getGroupID(),data:l,timeout:0})]:[3,2];case 1:return s.sent(),[3,4];case 2:return[4,this._tsignaling.invite({userID:t[0],data:l,timeout:0})];case 3:s.sent(),s.label=4;case 4:return this._joined=!1,h=this._tuiCallEngine.generateCallEndData({callMediaType:n,totalTime:r}),this._tuiCallEngine._delegate.onCallEnd(h),[2]}}))}))},e.prototype.accept=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o;return s(this,(function(s){switch(s.label){case 0:return n=e.inviteID,r=e.callType,o=a(e,["inviteID","callType"]),[4,this._tsignaling.accept({inviteID:n,data:JSON.stringify(this.handleNewSignaling(i({version:0,call_type:r},o),t))})];case 1:return[2,s.sent()]}}))}))},e.prototype.reject=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return s(this,(function(s){return t=e.inviteID,n=e.callType,i=e.isBusy,r={version:0,call_type:n},i&&(r.line_busy="line_busy"),[2,this._tsignaling.reject({inviteID:t,data:JSON.stringify(this.handleNewSignaling(r,{message:i?"lineBusy":""}))})]}))}))},e.prototype.cancel=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(i){return t=e.inviteID,n=JSON.stringify(this.handleNewSignaling({version:4,businessID:"av_call",call_type:this._tuiCallEngine.getCallType()})),[2,this._tsignaling.cancel({inviteID:t,data:n})]}))}))},e.prototype.resetJoined=function(){this._joined=!1},e.prototype.switchCallMode=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,a,o,l,u;return s(this,(function(s){switch(s.label){case 0:return t=e.userID,n=e.callType,i=e.roomID,r=e.timeout,a=e.mode,o={version:0,call_type:n,room_id:i,switch_to_audio_call:null},l={cmd:c.CMD_TYPE.SWITCH_TO_VIDEO},a===c.MODE_TYPE.AUDIO?(o.switch_to_audio_call=c.CMD_TYPE.SWITCH_TO_AUDIO_CALL,l.cmd=c.CMD_TYPE.SWITCH_TO_AUDIO):delete o.switch_to_audio_call,[4,this._tsignaling.invite({userID:t,data:JSON.stringify(this.handleNewSignaling(o,l)),timeout:r})];case 1:return(u=s.sent()).inviteID&&this._tuiCallEngine.addAudioVideoSwitchIdList(u.inviteID),[2]}}))}))},e.prototype.handleNewSignaling=function(e,t){return i(i({extraInfo:""},e),{version:4,businessID:"av_call",platform:"Web",data:i({cmd:c.CMD_TYPE_LIST[e.call_type],room_id:e.room_id,message:""},t)})},e}();t.default=p},function(e,t){e.exports=i},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(14),s=n(0),a=n(7),o=n(11),l=n(12),u="TUICallObserver",c=function(){function e(e){this._eventEmitter=e,this._eventStatController=new l.default,a.default.bindController(this._eventStatController)}return e.prototype._setInterfaceUpLoad=function(e){return s.default.time(e),new a.default(e)},e.prototype.onError=function(e,t){s.default.debug(u+".onError code:"+e+" msg:"+t),this._eventEmitter.emit(r.TUICallEvent.ERROR,{code:e,msg:t}),this._setInterfaceUpLoad(o.default.ERROR).setText("").setEnd()},e.prototype.onSdkReady=function(e){s.default.debug(u+".onSdkReady params:"+e),this._eventEmitter.emit(r.TUICallEvent.SDK_READY,e),this._setInterfaceUpLoad(o.default.SDK_READY).setText("").setEnd()},e.prototype.onInvited=function(e){s.default.debug(u+".onInvited params:",e);var t=e.sponsor,n=e.userIDList,i=e.isFromGroup,a=e.inviteData,l=e.inviteID;this._eventEmitter.emit(r.TUICallEvent.INVITED,{sponsor:t,userIDList:n,isFromGroup:i,inviteData:a,inviteID:l}),this._setInterfaceUpLoad(o.default.INVITED).setText("TUICallEvent.INVITED emitted").setEnd()},e.prototype.onUserAccept=function(e){s.default.debug(u+".onUserAccept userID:"+e),this._eventEmitter.emit(r.TUICallEvent.USER_ACCEPT,{userID:e})},e.prototype.onUserEnter=function(e){s.default.debug(u+".onUserEnter userID:"+e),this._eventEmitter.emit(r.TUICallEvent.USER_ENTER,{userID:e}),this._setInterfaceUpLoad(o.default.USER_ENTER).setText("TUICallEvent.USER_ENTER emitted").setEnd()},e.prototype.onUserLeave=function(e){s.default.debug(u+".onUserLeave userID:"+e),this._eventEmitter.emit(r.TUICallEvent.USER_LEAVE,{userID:e}),this._setInterfaceUpLoad(o.default.USER_LEAVE).setText("TUICallEvent.USER_LEAVE emitted").setEnd()},e.prototype.onReject=function(e){s.default.debug(u+".onReject userID:"+e),this._eventEmitter.emit(r.TUICallEvent.REJECT,{userID:e}),this._setInterfaceUpLoad(o.default.REJECT).setText("TUICallEvent.REJECT emitted").setEnd()},e.prototype.onNoResp=function(e,t){s.default.debug(u+".onNoResp userIDList:",e,t),this._eventEmitter.emit(r.TUICallEvent.NO_RESP,{sponsor:e,userIDList:t}),this._setInterfaceUpLoad(o.default.NO_RESP).setText("TUICallEvent.NO_RESP emitted").setEnd()},e.prototype.onLineBusy=function(e){s.default.debug(u+".onLineBusy userID:"+e),this._eventEmitter.emit(r.TUICallEvent.LINE_BUSY,{userID:e}),this._setInterfaceUpLoad(o.default.LINE_BUSY).setText("TUICallEvent.LINE_BUSY emitted").setEnd()},e.prototype.onCallingCancel=function(e){void 0===e&&(e=""),s.default.debug(u+".onCallingCancel ",e),this._eventEmitter.emit(r.TUICallEvent.CALLING_CANCEL,{userID:e}),this._setInterfaceUpLoad(o.default.CALLING_CANCEL).setText("TUICallEvent.CALLING_CANCEL emitted").setEnd()},e.prototype.onKickedOut=function(){s.default.debug(u+".onKickedOut"),this._eventEmitter.emit(r.TUICallEvent.KICKED_OUT,{}),this._setInterfaceUpLoad(o.default.KICKED_OUT).setText("TUICallEvent.KICKED_OUT emitted").setEnd()},e.prototype.onCallingTimeout=function(e,t){s.default.debug(u+".onCallingTimeout userIDList:",t),this._eventEmitter.emit(r.TUICallEvent.CALLING_TIMEOUT,{sponsor:e,userIDList:t}),this._setInterfaceUpLoad(o.default.CALLING_TIMEOUT).setText("TUICallEvent.CALLING_TIMEOUT emitted").setEnd()},e.prototype.onCallEnd=function(e){s.default.debug(u+".onCallEnd params:"+e),this._eventEmitter.emit(r.TUICallEvent.CALLING_END,i(i({},e),{callEnd:e.totalTime})),this._setInterfaceUpLoad(o.default.CALLING_END).setText("TUICallEvent.CALLING_END emitted").setEnd()},e.prototype.onUserVideoAvailable=function(e){s.default.debug(u+".onUserVideoAvailable params:",e);var t=e.userID,n=e.isVideoAvailable;this._eventEmitter.emit(r.TUICallEvent.USER_VIDEO_AVAILABLE,{userID:t,isVideoAvailable:n});var i="TUICallEvent.USER_VIDEO_AVAILABLE emitted, userID: "+t+", video: "+n;this._setInterfaceUpLoad(o.default.USER_VIDEO_AVAILABLE).setText(i).setEnd()},e.prototype.onUserAudioAvailable=function(e){s.default.debug(u+".onUserAudioAvailable params:",e);var t=e.userID,n=e.isAudioAvailable;this._eventEmitter.emit(r.TUICallEvent.USER_AUDIO_AVAILABLE,{userID:t,isAudioAvailable:n});var i="TUICallEvent.USER_AUDIO_AVAILABLE emitted, userID: "+t+", mic: "+n;this._setInterfaceUpLoad(o.default.USER_AUDIO_AVAILABLE).setText(i).setEnd()},e.prototype.onUserVoiceVolume=function(e){this._eventEmitter.emit(r.TUICallEvent.USER_VOICE_VOLUME,{volumeMap:e}),this._setInterfaceUpLoad(o.default.USER_VOICE_VOLUME).setText("TUICallEvent.USER_VOICE_VOLUME emitted").setEnd()},e.prototype.onGroupCallInviteeListUpdate=function(e){this._eventEmitter.emit(r.TUICallEvent.GROUP_CALL_INVITEE_LIST_UPDATE,{userIDList:e}),this._setInterfaceUpLoad(o.default.GROUP_CALL_INVITEE_LIST_UPDATE).setText("TUICallEvent.GROUP_CALL_INVITEE_LIST_UPDATE emitted").setEnd()},e.prototype.onCallTypeChanged=function(e,t){this._eventEmitter.emit(r.TUICallEvent.CALL_TYPE_CHANGED,{oldCallType:e,newCallType:t}),this._setInterfaceUpLoad(o.default.CALL_TYPE_CHANGED).setText("TUICallEvent.CALL_TYPE_CHANGED "+t).setEnd()},e.prototype.onDeviceUpdated=function(e,t,n,i){this._eventEmitter.emit(r.TUICallEvent.DEVICED_UPDATED,{microphoneList:e,cameraList:t,currentMicrophone:n,currentCamera:i}),this._setInterfaceUpLoad(o.default.DEVICED_UPDATED).setText("TUICallEvent.GROUP_CALL_INVITEE_LIST_UPDATE emitted").setEnd()},e.prototype.onMessageSentByMe=function(e){this._eventEmitter.emit(r.TUICallEvent.MESSAGE_SENT_BY_ME,e)},e}();t.default=c},function(e,t,n){"use strict";n.r(t);var i=n(0);const r="none",s="online",a=function(){let e=window.location.protocol;return["http:","https:"].indexOf(e)<0&&(e="http:"),e};t.default=class{constructor(){this._networkType="",this.maxWaitTime=3e3}start(){this._networkType=s}_onNetworkStatusChange(e){this._networkType=e.networkType,e.isConnected?i.default.info("NetMonitor networkType:"+e.networkType):i.default.warn("NetMonitor no network, please check!")}probe(){return new Promise(e=>{if(window&&window.fetch)fetch(`${a()}//webim-1252463788.file.myqcloud.com/assets/test/speed.xml?random=${Math.random()}`).then(t=>{t.ok?e([!0,s]):e([!1,r])}).catch(()=>{e([!1,r])});else{const t=new XMLHttpRequest,n=setTimeout(()=>{i.default.warn("NetMonitor fetch timeout. Probably no network, please check!"),t.abort(),this._networkType=r,e([!1,r])},this.maxWaitTime);t.onreadystatechange=function(){4===t.readyState&&(clearTimeout(n),200===t.status||304===t.status?(this._networkType=s,e([!0,s])):(i.default.warn(`NetMonitor fetch status:${t.status}. Probably no network, please check!`),this._networkType=r,e([!1,r])))},t.open("GET",`${a()}//webim-1252463788.file.myqcloud.com/assets/test/speed.xml?random=${Math.random()}`),t.send()}})}getNetworkType(){return this._networkType}reset(){this._networkType=""}}},function(e,t,n){"use strict";n.r(t),n.d(t,"isFunction",(function(){return i})),n.d(t,"isUndefined",(function(){return r})),n.d(t,"isString",(function(){return s})),n.d(t,"isNumber",(function(){return a})),n.d(t,"isBoolean",(function(){return o})),n.d(t,"isPlainObject",(function(){return l}));const i=e=>"function"==typeof e,r=e=>void 0===e,s=e=>"string"==typeof e,a=e=>"number"==typeof e,o=e=>"boolean"==typeof e,l=function(e){if(!e||"object"!=typeof e||"[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);if(null===t)return!0;const n=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Function.prototype.toString.call(n)===Function.prototype.toString.call(Object)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.apiCallQueue=t.avoidRepeatedCall=t.statusValidate=t.deviceValidate=t.businessValidate=t.paramValidate=t.API_STATUS=t.VALIDATE_PARAMS=void 0;var i=n(61);Object.defineProperty(t,"VALIDATE_PARAMS",{enumerable:!0,get:function(){return i.VALIDATE_PARAMS}});var r=n(26);Object.defineProperty(t,"API_STATUS",{enumerable:!0,get:function(){return r.API_STATUS}});var s=n(62);Object.defineProperty(t,"paramValidate",{enumerable:!0,get:function(){return s.paramValidate}});var a=n(25);Object.defineProperty(t,"businessValidate",{enumerable:!0,get:function(){return a.businessValidate}});var o=n(63);Object.defineProperty(t,"deviceValidate",{enumerable:!0,get:function(){return o.deviceValidate}});var l=n(64);Object.defineProperty(t,"statusValidate",{enumerable:!0,get:function(){return l.statusValidate}});var u=n(65);Object.defineProperty(t,"avoidRepeatedCall",{enumerable:!0,get:function(){return u.avoidRepeatedCall}});var c=n(66);Object.defineProperty(t,"apiCallQueue",{enumerable:!0,get:function(){return c.apiCallQueue}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VALIDATE_PARAMS=void 0;var i=n(26);t.VALIDATE_PARAMS={createInstance:{SDKAppID:{required:!0,rules:[i.VALIDATE_TYPR.NUMBER],allowEmpty:!1},tim:{required:!1,rules:[i.VALIDATE_TYPR.OBJECT],allowEmpty:!0}},login:{userID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},userSig:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},call:{userID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},type:{required:!0,rules:[i.VALIDATE_TYPR.NUMBER],range:[1,2],allowEmpty:!1},timeout:{required:!1,rules:[i.VALIDATE_TYPR.NUMBER],allowEmpty:!1}},groupCall:{userIDList:{required:!0,rules:[i.VALIDATE_TYPR.ARRAY],allowEmpty:!1},type:{required:!0,rules:[i.VALIDATE_TYPR.NUMBER],range:[1,2],allowEmpty:!1},groupID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},timeout:{required:!1,rules:[i.VALIDATE_TYPR.NUMBER],allowEmpty:!1}},joinInGroupCall:{type:{required:!0,rules:[i.VALIDATE_TYPR.NUMBER],range:[1,2],allowEmpty:!1},groupID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},roomID:{required:!0,rules:[i.VALIDATE_TYPR.NUMBER],allowEmpty:!1}},inviteUser:{userIDList:{required:!0,rules:[i.VALIDATE_TYPR.ARRAY],allowEmpty:!1}},startRemoteView:{userID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},videoViewDomID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},stopRemoteView:{userID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},startLocalView:{userID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},videoViewDomID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},stopLocalView:{userID:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},switchDevice:{deviceType:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},deviceId:{required:!0,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}},setVideoQuality:[{key:"profile",required:!0,rules:[i.VALIDATE_TYPR.STRING,i.VALIDATE_TYPR.OBJECT],range:[1,2],allowEmpty:!1}],switchCallMediaType:[{key:"newMediaType",required:!0,rules:[i.VALIDATE_TYPR.NUMBER],range:[1,2],allowEmpty:!1}],getDeviceList:[{key:"deviceType",required:!0,rules:[i.VALIDATE_TYPR.STRING],range:["camera","microphones"],allowEmpty:!1}],setSelfInfo:{nickName:{required:!1,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1},avatar:{required:!1,rules:[i.VALIDATE_TYPR.STRING],allowEmpty:!1}}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.paramValidate=void 0;var r=n(1),s=n(9),a=n(3);function o(e,t,n){try{if(r.isArray(e))for(var s=0;s<e.length;s++)l.call(this,i(i({},e[s]),{value:t[s],name:n}));else for(var a in e)l.call(this,i(i({},e[a]),{value:t[0][a],name:n,key:a}))}catch(e){throw e}}function l(e){var t=e.required,n=e.rules,i=e.range,o=e.value,l=e.allowEmpty,u=e.name,c=e.key;if(t&&!l||o){if(!o)throw new s.default({message:"API<"+u+">: "+c+" is blank",code:a.default.ERROR_PARAM_INVALID});var d="";if(!n.some((function(e){return e===r.getType(o)}))){for(var h=0;h<n.length;h++){var p=n[h];d+=(p=p.replace(p[0],p[0].toUpperCase()))+"/"}throw d=d.substring(0,d.length-1),new s.default({message:"API<"+u+">: "+c+" must is "+d,code:a.default.ERROR_PARAM_INVALID})}if(i&&-1===i.indexOf(o))throw new s.default({message:"API<"+u+">: "+c+" error, only be "+i,code:a.default.ERROR_PARAM_INVALID})}}t.paramValidate=function(e){return function(t,n,i){var r=i.value;return i.value=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return o.call(this,e,t,n),r.apply(this,t)},i}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.deviceValidate=void 0;var s=n(9),a=n(3),o=n(5);function l(e,t,n){return i(this,void 0,void 0,(function(){var i,l;return r(this,(function(r){switch(r.label){case 0:if(this._permission[n])return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._trtcClient.getMediaDevicesAuth((l={},l[n]=!0,l.isThrowVideoError=!0,l))];case 2:return r.sent(),[3,4];case 3:throw i=r.sent(),this._delegate.onError(a.default.NOT_MEDIA_ACCESS,JSON.stringify(i)),new s.default({message:o.default.ERROR_PERMISSION_DENIED,code:a.default.ERROR_PERMISSION_DENIED});case 4:return e.apply(this,t),[2]}}))}))}t.deviceValidate=function(e){return function(t,n,s){var a=s.value;return s.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,l.call(this,a,t,e)];case 1:return[2,n.sent()];case 2:throw n.sent();case 3:return[2]}}))}))},s}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.statusValidate=void 0;var i=n(9),r=n(3),s=n(5);function a(e,t,n){var a;if((null==e?void 0:e.init)&&!this._isLogin)throw new i.default({message:"API<"+n+">: "+s.default.ERROR_INIT_FAIL,code:r.default.ERROR_INIT_FAIL});if(-1===(null===(a=null==e?void 0:e.callStatus)||void 0===a?void 0:a.indexOf(this._callStatus)))throw new i.default({message:"API<"+n+">: "+s.default.ERROR_REQUEST_REFUSED+" "+e.callStatus.join("/"),code:r.default.ERROR_REQUEST_REFUSED});if((null==e?void 0:e.scene)&&this._isGroupCall)throw new i.default({message:"API<"+n+">: "+s.default.ERROR_SCENE_NOT_SUPPORTED,code:r.default.ERROR_SCENE_NOT_SUPPORTED})}t.statusValidate=function(e){return function(t,n,i){var r=i.value;return i.value=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return a.call(this,e,t,n),r.apply(this,t)},i}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.avoidRepeatedCall=void 0,t.avoidRepeatedCall=function(){return function(e,t,n){var s=n.value,a=new Set;return n.value=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return i(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:if(a.has(this))throw new Error("previous "+t+"() is ongoing, please avoid repeated calls");r.label=1;case 1:return r.trys.push([1,3,,4]),a.add(this),[4,s.apply(this,e)];case 2:return n=r.sent(),a.delete(this),[2,n];case 3:throw i=r.sent(),a.delete(this),i;case 4:return[2]}}))}))},n}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.apiCallQueue=void 0;var r=new WeakMap;t.apiCallQueue=function(){return function(e,t,n){var s=n.value,a=function(e){var t=e.fn,n=e.args,s=e.context,o=e.resolve,l=e.reject;t.apply(s,n).then(o,l).finally((function(){var e=r.get(s);e.shift(),e[0]&&a(i({},e[0]))}))};return n.value=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new Promise((function(n,i){if(r.has(e)){var o=r.get(e),l=o.length;o.push({fn:s,args:t,context:e,resolve:n,reject:i}),0===l&&a({fn:s,args:t,context:e,resolve:n,reject:i})}else r.set(e,[{fn:s,args:t,context:e,resolve:n,reject:i}]),a({fn:s,args:t,context:e,resolve:n,reject:i})}))},n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TUICallEngineObserver=t.CallDataReport=void 0;var i=n(6),r=n(14),s=n(7),a=n(11),o=n(12),l=n(10),u=n(68),c=n(1),d=function(){function e(e){this._eventStatController=new o.default,s.default.bindController(this._eventStatController),this.initializeCallData(e),this._ssoLog=new s.default(a.default.QUALITY_REPORT)}return e.prototype.setCallData=function(e){this._callData=e},e.prototype.getCallData=function(){return this._callData},e.prototype.setInviteID=function(e){this._callData.inviteID=e},e.prototype.setTotalTime=function(e){this._callData.totalTime=e},e.prototype.setAbilityBit=function(e){this._callData.abilityBit=!!e},e.prototype.setEnterRoomTime=function(e){this._callData.enterRoomTime=u.convertTimeStampToString(e)},e.prototype.setSendSignalingTime=function(e){this._callData.sendSignalingTime=u.convertTimeStampToString(e)},e.prototype.setCallAcceptTime=function(e){this._callData.callAcceptTime=u.convertTimeStampToString(e)},e.prototype.setExitRoomTime=function(e){this._callData.exitRoomTime=u.convertTimeStampToString(e)},e.prototype.setCallEndTime=function(e){this._callData.callEndTime=e},e.prototype.setCodeAndMessage=function(e,t){this._callData.code=e||0,this._callData.message=t||""},e.prototype.setCallScene=function(e){this._callData.callScene=e||""},e.prototype.getResult=function(){return this._callData.result},e.prototype.setResult=function(e){this._callData.result=e||""},e.prototype.setUserID=function(e){this._callData.userID=e||""},e.prototype._callTypeMapping=function(e){var t=l.NAME.UNKNOWN;switch(e){case i.CALL_TYPE.AUDIO_CALL:t=l.NAME.AUDIO;break;case i.CALL_TYPE.VIDEO_CALL:t=l.NAME.VIDEO}return t},e.prototype._callRoleMapping=function(e){var t=e;return t===i.CALL_ROLE.INVITER?t=l.NAME.CALLER:t===i.CALL_ROLE.INVITEE&&(t=l.NAME.CALLEE),t},e.prototype.packageCallDataToKibana=function(){var e=this._callTypeMapping(this._callData.callType),t=this._callRoleMapping(this._callData.callRole);return"CallData{version='"+this._callData.version+", platform="+this._callData.platform+", framework="+this._callData.framework+", sdk_app_id="+this._callData.sdkAppId+", user_id="+this._callData.userID+", room_id="+this._callData.roomID+", invite_id="+this._callData.inviteID+", invitee_list="+this._callData.inviteeList+", media_type="+e+", role="+t+", call_scene="+this._callData.callScene+", result="+this._callData.result+", total_time="+this._callData.totalTime+", total_score="+this._callData.totalScore+", ability_bit="+this._callData.abilityBit+", enter_room="+this._callData.enterRoomTime+", send_signaling="+this._callData.sendSignalingTime+", call_accept="+this._callData.callAcceptTime+", exit_room="+this._callData.exitRoomTime+", call_end="+this._callData.callEndTime+", code="+this._callData.code+", message="+this._callData.message+", network="+this._callData.network+", audio="+this._callData.audio+", video="+this._callData.video+"}"},e.prototype.initializeCallData=function(e){var t=e.version,n=void 0===t?"":t,r=e.sdkAppId,s=void 0===r?0:r,a=e.userID,o=void 0===a?"":a,u=c.getHostType();this._callData={version:n,platform:u,framework:l.NAME.WEB,sdkAppId:s,userID:o,roomID:0,inviteID:"",callRole:i.CALL_ROLE.UNKNOWN,callScene:"",callType:i.CALL_TYPE.UNKNOWN,inviteeList:[],result:l.NAME.UNKNOWN,totalTime:0,totalScore:0,code:0,message:"",abilityBit:!1,enterRoomTime:"",sendSignalingTime:"",callAcceptTime:"",exitRoomTime:"",callEndTime:"",network:0,audio:0,video:0}},e.prototype.reset=function(){this.initializeCallData(),this._ssoLog=null},e.prototype.clearCallDataAfterUpload=function(){var e=this.getCallData(),t=e.version,n=e.sdkAppId,i=e.userID;this.initializeCallData({version:t,sdkAppId:n,userID:i})},e.prototype.uploadToKibana=function(){try{this._ssoLog.setText(this.packageCallDataToKibana()).setEnd(),this.clearCallDataAfterUpload()}catch(e){}},e}();t.CallDataReport=d;var h=function(){function e(e,t){this._eventEmitter=e,this._callDataReport=t,this.registerListener()}return e.prototype.registerListener=function(){this._eventEmitter.on(r.TUICallEvent.CALLING_END,this.onCallEnd.bind(this)),this._eventEmitter.on(r.TUICallEvent.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.on(r.TUICallEvent.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.on(r.TUICallEvent.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.on(r.TUICallEvent.REJECT,this.onReject.bind(this))},e.prototype.removeLister=function(){this._eventEmitter.off(r.TUICallEvent.CALLING_END,this.onCallEnd.bind(this)),this._eventEmitter.off(r.TUICallEvent.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.off(r.TUICallEvent.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.off(r.TUICallEvent.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.off(r.TUICallEvent.REJECT,this.onReject.bind(this))},e.prototype.onCallEnd=function(e){var t=e.totalTime,n=void 0===t?0:t;this._callDataReport.setTotalTime(n),this._callDataReport.setResult(l.NAME.NORMAL),this._callDataReport.setCodeAndMessage(),this._callDataReport.uploadToKibana()},e.prototype.onCallingCancel=function(){this._callDataReport.getResult()||this._callDataReport.setResult(l.NAME.CANCEL),this._callDataReport.setCodeAndMessage(),this._callDataReport.uploadToKibana()},e.prototype.onNoResponse=function(){this._callDataReport.setResult(l.NAME.TIMEOUT)},e.prototype.onLineBusy=function(){this._callDataReport.setResult(l.NAME.BUSYLINE)},e.prototype.onReject=function(){this._callDataReport.setResult(l.NAME.REJECT)},e}();t.TUICallEngineObserver=h},function(e,t,n){"use strict";n.r(t),n.d(t,"setBaseTime",(function(){return l})),n.d(t,"getCurrentTime",(function(){return u})),n.d(t,"getTimestamp",(function(){return c})),n.d(t,"convertTimeStampToString",(function(){return d}));var i=n(0),r=n(28),s=n.n(r);let a=(new Date).getTime(),o=0;const l=function(e){a=e,o=a-(new Date).getTime();const t=new Date;t.setTime(e),i.default.info("baseTime from server: "+t+" offset: "+o)},u=function(){return(new Date).getTime()+o},c=function(){const e=new Date;return e.setTime(u()),e.toLocaleString()},d=e=>e<=0?"":s()(e).format("YYYY-MM-DD HH:mm:ss")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TUICallType=void 0,t.TUICallType={AUDIO_CALL:1,VIDEO_CALL:2,DEVCIED_CAMERA:"camera",DEVCIED_MICROPHONES:"microphones"}}]).default}));